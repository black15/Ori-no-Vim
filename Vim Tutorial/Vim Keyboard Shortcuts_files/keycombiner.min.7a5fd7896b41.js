function isElectron(){return-1!=navigator.userAgent.indexOf("Electron")}function isMacOS(){return-1!=navigator.appVersion.indexOf("Mac")}var isMac=isMacOS(),useMac=isMac;function initCommandBar(t){var e="20a4524b",n=["Object.assign","Symbol","Symbol.for"].join("%2C"),i=window;function s(t,e){void 0===e&&(e=!1),"complete"!==document.readyState&&window.addEventListener("load",s.bind(null,t,e),{capture:!1,once:!0});var n=document.createElement("script");n.type="text/javascript",n.async=e,n.src=t,document.head.appendChild(n)}function o(){var t;if(void 0===i.CommandBar){delete i.__CommandBarBootstrap__;var n=Symbol.for("CommandBar::configuration"),o=Symbol.for("CommandBar::orgConfig"),a=Symbol.for("CommandBar::disposed"),r=Symbol.for("CommandBar::isProxy"),d=Symbol.for("CommandBar::queue"),l=Symbol.for("CommandBar::unwrap"),c=[],u=localStorage.getItem("commandbar.lc"),m=u&&u.includes("local")?"http://localhost:8000":"https://api.commandbar.com",b=Object.assign(((t={})[n]={uuid:e},t[o]={},t[a]=!1,t[r]=!0,t[d]=new Array,t[l]=function(){return b},t),i.CommandBar);i.CommandBar=new Proxy(b,{get:function(t,e){return e in b?b[e]:function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),b[d].push(t)}}}),null!==u&&c.push("lc="+u),c.push("version=2"),s(m+"/latest/"+e+"?"+c.join("&"),!0)}}return void 0===Object.assign||"undefined"==typeof Symbol||void 0===Symbol.for?(i.__CommandBarBootstrap__=o,s("https://polyfill.io/v3/polyfill.min.js?version=3.101.0&callback=__CommandBarBootstrap__&features="+n)):o(),window.CommandBar.boot(t),!0}function suppressCommandBar(){window.getSelectionDefault||(window.getSelectionDefault=window.getSelection),window.getSelection=function(){return" "}}function reEnableCommandBar(){window.getSelectionDefault&&(window.getSelection=window.getSelectionDefault)}const monthNames=["January","February","March","April","May","June","July","August","September","October","November","December"],preferredOrder=["meta","_meta","ctrl","_ctrl","alt","_alt","shift","_shift","cmd","_cmd"],preferredOrderReversed=["_cmd","cmd","_shift","shift","_alt","alt","_ctrl","ctrl","_meta","meta"],validSpecialKeys="fn|or|plus|backspace|tab|enter|shift|ctrl|cmd|alt|esc|capslock|space|pageup|pagedown|end|home|left|up|right|down|ins|del|option|prtsc|meta|f1|f2|f3|f4|f5|f6|f7|f8|f9|f10|f11|f12|numpad\\d|numlock",otherKeys="a-z0-9\\.\\-,;=`'\\]\\[\\\\/\\*",validKeysAndSyntaxPattern=new RegExp("^(["+otherKeys+"]|"+validSpecialKeys+"){1}([ +](["+otherKeys+"]|"+validSpecialKeys+"){1})*$"),browserPresetPattern=new RegExp("(ctrl|cmd)\\+(shift\\+)?(t$|n$|w|tab$)|ctrl\\+f4"),systemReservedPattern=new RegExp("alt\\+(f4|tab)|cmd\\+q");function keyIsModifier(t){return"shift"===(t=t.toLowerCase())||"ctrl"===t||"control"===t||"alt"===t||"meta"===t}function sortKeys(t){if(t.startsWith('"')&&t.endsWith('"'))return t;let e=t.toLowerCase().replace(/\s*\+\s*/g,"+").replace(/\s+/g," ").trim().split(" ");for(let t=0;t<e.length;t++){let n=e[t].split("+");n.sort((function(t,e){return preferredOrderReversed.indexOf(e)-preferredOrderReversed.indexOf(t)})),e[t]=n.join("+")}return e.join(" ")}function makeReplacements(t,e){if(!e)return t;let n=t.split(" ");for(let t=0;t<n.length;t++){let i=n[t].split("+");for(const[t,n]of Object.entries(e)){const e=i.indexOf(t);if(e>-1){i.splice(e,1);for(let t=0;t<n.length;t++)i.includes(n[t])||i.push(n[t])}}i.sort((function(t,e){return preferredOrderReversed.indexOf(e)-preferredOrderReversed.indexOf(t)})),n[t]=i.join("+")}return n.join(" ")}function setUpCsrf(){var t=jQuery("[name=csrfmiddlewaretoken]").val();$.ajaxSetup({beforeSend:function(e,n){csrfSafeMethod(n.type)||this.crossDomain||e.setRequestHeader("X-CSRFToken",t)}})}function splitKeys(t,e=null){let n=t.split(" or ");return e&&n.forEach((t,i)=>n[i]=makeReplacements(t,e)),n}function getSuperKeyLabel(){return useMac?"Cmd":"Meta"}function extractModifiersAndKey(t){let e="",n=[!1,!1,!1,!1],i=t.split("+");return 1===i.length?[i[0],n,"nomod"]:(t.includes("ctrl")&&(e+="ctrl",n[0]=!0),t.includes("alt")&&(e+="alt",n[1]=!0),t.includes("shift")&&(e+="shift",n[2]=!0),(t.includes("command")||t.includes("cmd")||t.includes("super")||t.includes("meta"))&&(e+="cmd",n[3]=!0),[i[i.length-1],n,e])}function extractModifiers(t){if(void 0===t)return"";let e="";return t.startsWith('"')&&t.endsWith('"')?"Text Snippet":(t.includes("meta")&&(e+="<kbd>meta</kbd> "),t.includes("ctrl")&&(e+="<kbd>ctrl</kbd> "),t.includes("alt")&&(e+="<kbd>alt</kbd> "),t.includes("shift")&&(e+="<kbd>shift</kbd> "),(t.includes("command")||t.includes("cmd"))&&(e+="<kbd>cmd</kbd> "),""===e&&(e="None"),e)}function escapeHtml(t){return t.replace(/ & /g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;")}function addKbdTags(t){if(void 0===t)return"";let e;return t.startsWith('"')&&t.endsWith('"')?(e=(t=escapeHtml(t)).slice(1,-1),e=e.replaceAll('" or "',"</textsnippet>&nbsp;or<br><textsnippet>"),e="<textsnippet>"+e+"</textsnippet>"):(e=t.replace(/\+/g,"</kbd>&nbsp;+&nbsp;<kbd>"),e=e.replace(/\s+or\s+/g,"</kbd>&nbsp;or<br><kbd>"),e=e.replace(/[\s]+/g,'</kbd>&nbsp;<i class="mdi mdi-chevron-right inline-icon" aria-hidden="true"></i>&nbsp;<kbd>'),e="<kbd>"+e+"</kbd>"),e}function isPrefixOfSnippet(t,e){let n=t.split('" or "'),i=!1;for(const t of n)if(t.startsWith(e)){i=!0;break}return i}function isEqualTextSnippet(t,e){let n=t.split('" or "'),i=!1;for(const t of n)if(t===e){i=!0;break}return i}function csrfSafeMethod(t){return/^(GET|HEAD|OPTIONS|TRACE)$/.test(t)}function getCol(t,e){for(var n=[],i=0;i<t.length;i++)n.push(t[i][e]);return n}function truncateString(t,e){return t.length>e?t.substring(0,e-3)+"...":t}function addToCopyDropdown(t){$("#addToCollectionDropdown").append('\n    <div class="dropdown-divider"></div>\n    <a class="dropdown-item  copybutton" id="copyCombinationsBtn-'+t.id+'">'+t.name+"</a>")}function addToSideBar(t){$("#sideNavCollections").append('\n    <a href="/collecting/collections/personal/'+t.id+'"/ data-toggle="tooltip"\n           title="Go to personal collection"\n           class="list-group-item list-group-item-action bg-light pl-4 pt-2 pb-2 border-0">'+t.name+"</a>")}function addToMoveDropdown(t){$("#moveToCollectionDropdown").append('\n    <div class="dropdown-divider"></div>\n    <a class="dropdown-item  movebutton" id="moveCombinationsBtn-'+t.id+'">'+t.name+"</a>")}function addCollectedIcon(t,e,n){for(i=0;i<e.length;i++){let s=t.row("#row"+e[i]),o=s.data();""===s.data()[0]||"None"===s.data()[0]?o[0]=n.trim():o[0]=s.data()[0]+", "+n.trim(),s.invalidate("data")}}function isValidCombination(t){return!(!t.startsWith('"')||!t.endsWith('"'))||!systemReservedPattern.test(t)&&(!(!isElectron()&&browserPresetPattern.test(t))&&validKeysAndSyntaxPattern.test(t))}function addWarnIfInvalid(t){return isValidCombination(t)?"":' <i title="This combination will not occur in practice, because it contains invalid keys or is reserved by your web browser." class="mdi mdi-alert-outline text-danger mdi-18px"></i>'}function collectingOperation(t,e,n,{hasMove:s=!1,isMove:o=!1,hasCollectedColumn:a=!1}={}){if(!t.rows(".selected").any())return void notification_app.makeToast(!1,"warning","Warning","None selected");let r=a?1:0,d=e.id,l=getCol(t.rows({selected:!0}).data(),r),c="Copied ";if(o&&(c="Moved "),"newCollectionBtn"==d){const e=function(t,e,n){notification_app.makeToast(!1,"danger","Error",JSON.parse(t.responseText))},r=function(e){if(addToCopyDropdown(e),addToSideBar(e),s&&addToMoveDropdown(e),notification_app.makeToast(!1,"success","Success","Created new collection ("+e.name+") with "+e.ids.length+" selected combinations."),o)for(i=0;i<e.ids.length;i++)t.row("#row"+e.ids[i]).remove();a&&addCollectedIcon(t,e.ids,n);let r=t.page();t.searchPanes.rebuildPane(void 0,!0),t.page(r),t.draw(!1),o&&(updatedMasteredCount(t),mapperApp&&mapperApp.rebuild())};o?moveCombinationsToNewPersonal(n,l,r,e):addcombinationsToNewPersonal(n,l,r,e)}else{let n=e.id.split("-")[1];var u=function(n){if(notification_app.makeToast(!1,"success","Success",c+n.ids.length+" key combination(s) to collection "+n.name+"."),o)for(i=0;i<n.ids.length;i++)t.row("#row"+n.ids[i]).remove();a&&addCollectedIcon(t,n.ids,e.innerText);let s=t.page();t.searchPanes.rebuildPane(void 0,!0),t.page(s),t.draw(!1),o&&(updatedMasteredCount(t),mapperApp&&mapperApp.rebuild())},m=function(t,e,n){notification_app.makeToast(!1,"danger","Error",JSON.parse(t.responseText))};o?moveCombinationsFromToPersonal(n,l,u,m):addcombinationsToPersonal(n,l,u,m)}}function toggleSideNav(t=!1){t||(sessionStorage.getItem("sideNaveClosed")?sessionStorage.removeItem("sideNaveClosed"):sessionStorage.setItem("sideNaveClosed",!0)),sessionStorage.getItem("sideNaveClosed")?($("#sidebar-wrapper").removeClass("shownSideNav"),$("#page-content-wrapper").removeClass("shownSideNav"),$("#toggleSideNavButton").html('<i class="mdi mdi-arrow-collapse-right" title=\'Show side navigation\' aria-hidden="true">')):($("#sidebar-wrapper").addClass("shownSideNav"),$("#page-content-wrapper").addClass("shownSideNav"),$("#toggleSideNavButton").html('<i class="mdi mdi-arrow-collapse-left" title=\'Hide side navigation\' aria-hidden="true">'))}function goToUrlWithConfirmation(t,e){confirm(e)&&(window.location.href=t)}function removeCombinations(t,e,n){setUpCsrf(),$.ajax({url:"/collecting/combinations/remove_from_personal/",type:"POST",data:JSON.stringify({ids:t}),contentType:"application/json; charset=utf-8",dataType:"json",success:e,error:n})}async function hasCollected(t,e,n){setUpCsrf(),$.ajax({url:"/collecting/api/combinations/collected/",type:"POST",data:JSON.stringify({ids:t}),contentType:"application/json; charset=utf-8",dataType:"json",success:e,error:n})}function deleteTestRuns(t,e,n){axios.defaults.xsrfCookieName="csrftoken",axios.defaults.xsrfHeaderName="X-CSRFTOKEN",axios.delete("/training/test-run/delete/",{data:t}).then(e).catch(n)}function addcombinationsToPersonal(t,e,n,i){setUpCsrf(),$.ajax({url:"/collecting/combinations/"+t+"/add-to-personal/",type:"POST",data:JSON.stringify({ids:e}),contentType:"application/json; charset=utf-8",dataType:"json",success:n,error:i})}function addcombinationsToNewPersonal(t,e,n,i){setUpCsrf(),$.ajax({url:"/collecting/collections/new/"+t+"/",type:"POST",data:JSON.stringify({ids:e}),contentType:"application/json; charset=utf-8",dataType:"json",success:n,error:i})}function moveCombinationsToNewPersonal(t,e,n,i){setUpCsrf(),$.ajax({url:"/collecting/collections/move/new/"+t+"/",type:"POST",data:JSON.stringify({ids:e}),contentType:"application/json; charset=utf-8",dataType:"json",success:n,error:i})}function moveCombinationsFromToPersonal(t,e,n,i){setUpCsrf(),$.ajax({url:"/collecting/combinations/"+t+"/move_from_to_personal/",type:"POST",data:JSON.stringify({ids:e}),contentType:"application/json; charset=utf-8",dataType:"json",success:n,error:i})}function update_collection_orders(t){setUpCsrf(),$.ajax({url:"/collecting/collections/update_order/",type:"POST",data:JSON.stringify({ids:t}),contentType:"application/json; charset=utf-8",dataType:"json",success:function(t){notification_app.makeToast(!1,"success","Success","Updated position of "+t.num_updated+" collections. The new positions will be reflected in the side navigation and instant lookup upon the next page refresh.")},error:function(t,e,n){notification_app.makeToast(!1,"danger","Error",JSON.parse(t.responseText))}})}function createPracticeRunChart(t,e,n,i=!1){let s=new Chart(e,{type:"bar",data:{labels:t.labels,datasets:[{label:"Correct",backgroundColor:"#75c588",yAxisID:"A",data:t.num_correct,categoryPercentage:.8,barPercentage:1,stack:0},{label:"With Hint",backgroundColor:"#c8ed8d",yAxisID:"A",categoryPercentage:.8,barPercentage:1,data:t.num_correct_with_keys,stack:0},{label:"Skipped",backgroundColor:"#9a9a9a",yAxisID:"A",categoryPercentage:.8,barPercentage:1,data:t.num_skipped,stack:1},{label:"Error",backgroundColor:"#ca7a7a",yAxisID:"A",categoryPercentage:.8,barPercentage:1,data:t.num_error,stack:1},{label:"Average Time",backgroundColor:"#579cc7",yAxisID:"B",categoryPercentage:.8,barPercentage:1,data:t.average_time,type:i?"line":"bar",borderColor:"#579cc7",fill:!1,spanGaps:!0,stack:2}]},options:{scales:{yAxes:[{id:"A",type:"linear",position:"left",stacked:"true"},{id:"B",type:"linear",position:"right",stacked:"true"}],xAxes:[{stacked:!0,ticks:{callback:function(t){return truncateString(t,40)}}}]},tooltips:{callbacks:{...n?{title:function(e,n){return truncateString(t.description[e[0].index],30)}}:{}}},onClick:function(n,i){let o=s.chartArea.bottom,a=(s.chart.height,s.chart.scales["x-axis-0"].width),r=$(e).offset().top-$(window).scrollTop();if(n.pageY>o+r){let e=s.scales["x-axis-0"].ticks.length,i=s.scales["x-axis-0"].paddingLeft,o=(a-i-s.scales["x-axis-0"].paddingRight)/e,r=(n.offsetX-i-s.scales.A.width)/o;r>0&r<e&&(r=Math.floor(r),t.xAxisHref[r]?window.location.href=t.xAxisHref[r]:notification_app.makeToast(!1,"danger","Error","This combination is no longer in your collections, hence no further statistics are available for it."))}},onHover:function(t){let n=s.chartArea.bottom,i=(s.chart.height,s.chart.scales["x-axis-0"].width),o=$(e).offset().top-$(window).scrollTop(),a=$(e).offset().left-$(window).scrollLeft(),r=a+s.scales["x-axis-0"].paddingLeft+s.scales["x-axis-0"].left,d=a+s.scales["x-axis-0"].paddingRight+s.scales["x-axis-0"].left+i;t.pageY>n+o&&t.pageX>r&&t.pageX<d?t.target.style.cursor="pointer":t.target.style.cursor="default"}}});return s}function getDefaultKeyMap(){return{Backquote:"`",Digit1:"1",Digit2:"2",Digit3:"3",Digit4:"4",Digit5:"5",Digit6:"6",Digit7:"7",Digit8:"8",Digit9:"9",Digit0:"0",Minus:"-",Equal:"=",IntlYen:"\\",KeyQ:"q",KeyW:"w",KeyE:"e",KeyR:"r",KeyT:"t",KeyY:"y",KeyU:"u",KeyI:"i",KeyO:"o",KeyP:"p",BracketLeft:"[",BracketRight:"]",Backslash:"\\",KeyA:"a",KeyS:"s",KeyD:"d",KeyF:"f",KeyG:"g",KeyH:"h",KeyJ:"j",KeyK:"k",KeyL:"l",Semicolon:":",Quote:"'",IntlBackslash:"\\",KeyZ:"z",KeyX:"x",KeyC:"c",KeyV:"v",KeyB:"b",KeyN:"n",KeyM:"m",Comma:",",Period:".",Slash:"/"}}!function(t){var e=function(e){t(e).submit()},n=function(e,n,s,o,a,r,d=null){t(e).find(n).load(o,(function(){t(e).modal("show"),t(s).attr("action",o),i(e,n,s,o,a,".submit-btn",d),t(".create-next-btn").length&&i(e,n,s,o,a,".create-next-btn",d,!0);let r=t(".create-as-new");r.length&&(o=r.data("action"),i(e,n,s,r.data("action"),a,".create-as-new",d))}))},i=function(n,i,o,a,r,d,l,c=!1){let u=t(d);u.off("click"),u.on("click",(function(t){t.preventDefault(),s(n,i,o,a,r,d,e,l,c)})),t(n).on("hidden.bs.modal",(function(e){t(o).remove()}))},s=function(e,s,o,a,r,d,l,c,u=!1){t.ajax({type:"POST",url:a,data:t(o).serialize(),beforeSend:function(){null===c&&t(d).prop("disabled",!0)},success:function(m){t(m).find(r).length>0||t(m).find(".alert-block").length>0?(t(e).find(s).html(m),t(o).attr("action",a),i(e,s,o,a,r,d,c,u)):null!==c?(u?n(e,s,o,a,r,0,c):t(e).modal("toggle"),c(m)):l(o)},error:function(t,e,n){notification_app.makeToast(!1,"danger","Error",t.responseText)}})};t.fn.modalForm=function(e){var i=t.extend({modalID:"#modal",modalContent:".modal-content",modalForm:".modal-content form",formURL:null,errorClass:".invalid-feedback",submitBtn:".submit-btn"},e);return this.each((function(){t(this).click((function(t){n(i.modalID,i.modalContent,i.modalForm,i.formURL,i.errorClass,i.submitBtn)}))}))},t.fn.modalFormAsync=function(e){var i=t.extend({modalID:"#modal",modalContent:".modal-content",modalForm:".modal-content form",formURL:null,errorClass:".invalid-feedback",submitBtn:".submit-btn"},e);n(i.modalID,i.modalContent,i.modalForm,i.formURL,i.errorClass,i.submitBtn,e.callback)}}(jQuery),void 0===navigator.keyboard&&(navigator.keyboard=new function(){return{getLayoutMap:function(){return new Promise((t,e)=>{t(new Map(Object.entries(getDefaultKeyMap())))})},layoutsNotSupported:!0}});var table=void 0;jQuery.extend({highlight:function(t,e,n,i){if(3===t.nodeType){var s=t.data.match(e);if(s){var o=document.createElement(n||"span");o.className=i||"highlight";var a=t.splitText(s.index);a.splitText(s[0].length);var r=a.cloneNode(!0);return o.appendChild(r),a.parentNode.replaceChild(o,a),1}}else if(1===t.nodeType&&t.childNodes&&!/(script|style)/i.test(t.tagName)&&(t.tagName!==n.toUpperCase()||t.className!==i))for(var d=0;d<t.childNodes.length;d++)d+=jQuery.highlight(t.childNodes[d],e,n,i);return 0}}),jQuery.fn.unhighlight=function(t){var e={className:"highlight",element:"span"};return jQuery.extend(e,t),this.find(e.element+"."+e.className).each((function(){var t=this.parentNode;t.replaceChild(this.firstChild,this),t.normalize()})).end()},jQuery.fn.highlight=function(t,e){var n={className:"highlight",element:"span",caseSensitive:!1,wordsOnly:!1};if(jQuery.extend(n,e),t.constructor===String&&(t=[t]),t=jQuery.grep(t,(function(t,e){return""!=t})),0==(t=jQuery.map(t,(function(t,e){return t.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")}))).length)return this;var i=n.caseSensitive?"":"i",s="("+t.join("|")+")";n.wordsOnly&&(s="\\b"+s+"\\b");var o=new RegExp(s,i);return this.each((function(){jQuery.highlight(this,o,n.element,n.className)}))},function(t,e,n){function i(t,e){t.unhighlight(),e.rows({filter:"applied"}).data().length&&(e.columns().every((function(){this.nodes().flatten().to$().unhighlight({className:"column_highlight"}),this.nodes().flatten().to$().highlight(n.trim(this.search()).split(/\s+/),{className:"column_highlight"})})),t.highlight(n.trim(e.search()).split(/\s+/)))}n(e).on("init.dt.dth",(function(t,e,s){if("dt"===t.namespace){var o=new n.fn.dataTable.Api(e),a=n(o.table().body());(n(o.table().node()).hasClass("searchHighlight")||e.oInit.searchHighlight||n.fn.dataTable.defaults.searchHighlight)&&(o.on("draw.dt.dth column-visibility.dt.dth column-reorder.dt.dth",(function(){i(a,o)})).on("destroy",(function(){o.off("draw.dt.dth column-visibility.dt.dth column-reorder.dt.dth")})),o.search()&&i(a,o))}}))}(window,document,jQuery);const collectionTableDom="<'row d-flex' <'col flex-grow-1' <'row'<'col-auto'l><'col-auto ml-auto'f>>\n                            <'row'<'col-sm-6'B> <'col-sm-6 text-right' <\"toolbar\">>  >\n                            <'row'<'col-md-12' tr>>\n                            <'row '<'col-sm-5'i><'col-sm-7'p>>>  <'col flex-grow-0' P> >",languageSettings={searchPanes:{emptyPanes:"Not enough data for filtering panes"}},exportbuttons={extend:"collection",text:"Export",buttons:[{exportOptions:{columns:":visible",orthogonal:"filter"}},{extend:"excel",exportOptions:{columns:":visible",orthogonal:"filter"}},{extend:"csv",exportOptions:{columns:":visible",orthogonal:"filter"}},{extend:"pdf",exportOptions:{columns:":visible",orthogonal:"filter"}},{extend:"print",exportOptions:{columns:":visible",orthogonal:"filter"}}]},noSubscriptionExportButton={extend:"collection",enabled:!1,text:"Export",attr:{title:"Export of collections is only possible with a Pro subscription. Please check the features page for more information."}};function postInitCombinationDataTable(t,e,n=!1){e.selectable({distance:10,filter:"tr",selected:function(e,n){e.ctrlKey||t.rows({selected:!0}).deselect(),t.rows(".ui-selected").select()},stop:function(t){$(this).find(".ui-selected").removeClass("ui-selected")}}),t.on("deselect",(function(e,n,i,s){t.rows(".selected").any()?$(".selectionActionButton").prop("disabled",!1):$(".selectionActionButton").prop("disabled",!0),$("#selectedcount").html(t.rows({selected:!0}).count())})),t.on("select",(function(e,n,i,s){t.rows(".selected").any()?$(".selectionActionButton").prop("disabled",!1):$(".selectionActionButton").prop("disabled",!0),$("#selectedcount").html(t.rows({selected:!0}).count())})),Mousetrap2.bind("mod+a",(function(e){t.rows().select(),e.preventDefault()})),Mousetrap2.bind("mod+shift+a",(function(e){t.rows().deselect(),e.preventDefault()})),Mousetrap2.bind("shift+c",(function(t){t.preventDefault(),t.stopPropagation(),$("#copybtn").click()})),n&&(Mousetrap2.bind("shift+del",(function(t){t.preventDefault(),t.stopPropagation(),$("#removeset").click()})),Mousetrap2.bind("shift+n",(function(t){t.preventDefault(),t.stopPropagation(),$(".create-keycombination").click()})),Mousetrap2.bind("shift+m",(function(t){$("#movebtn").click()}))),$(".table-responsive").on("show.bs.dropdown",(function(){$(".table-responsive").css("overflow","inherit")})),$(".table-responsive").on("hide.bs.dropdown",(function(){$(".table-responsive").css("overflow","auto")}))}function prepareDataTable(){$.fn.dataTable.ext.type.order["key-combination-pre"]=function(t){if("Text Snippet"===t)return 0;if("None"===t)return 1;let e=t.replace(/(<([^>]+)>)/gi,"").split(" "),n=0;for(i=0;i<e.length;i++)n+=preferredOrder.indexOf(e[i]);return 10*e.length+n}}function initTableColumnSearch(t){$("#table tfoot th").each((function(){let t=$(this).text();t&&$(this).html('<input type="text" class="form-control" placeholder="Search '+t+'" />')})),t.columns().every((function(){let t=this;$("input",this.footer()).on("keyup change clear",(function(){t.search()!==this.value&&t.search(this.value).draw()}))}))}const selectMode={style:window.matchMedia("(pointer: coarse)").matches?"multi+shift":"os"},basicTableButtons=[{extend:"colvis",text:'<i class="mdi mdi-eye-outline" aria-hidden="true"></i>',attr:{title:"Column Visibility"}},{extend:"selectAll",text:'<i class="mdi mdi-select-all" aria-hidden="true"></i>',attr:{title:"Select All | Ctrl/Cmd + A"}},{extend:"selectNone",text:'<i class="mdi mdi-select-off" aria-hidden="true"></i>',attr:{title:"Clear Selection | Ctrl/Cmd + Shift + A"}}];function initCollectionTable(t,e,n,i){let s=n?4:3,o=[visualizerButton,basicTableButtons,t?exportbuttons:noSubscriptionExportButton],a={searchHighlight:!0,language:languageSettings,iDisplayLength:25,lengthMenu:[[25,50,100,200],[25,50,100,200]],dom:collectionTableDom,select:selectMode,searchPanes:createSearchPaneSettings([0,6,7]),buttons:{dom:{button:{tag:"button",className:"btn btn-outline-primary"}},buttons:o},order:[[1,"asc"]],columnDefs:[{targets:0,searchable:e,visible:e,type:"html",width:"20px",render:{display:function(t,e,n,i){let s="";if(""===t||"None"===t)s="";else{if(t.startsWith("<i"))return t;s='<i title="'+t+'" class="mdi mdi-playlist-check collected-icon"></i>'}return s},sort:function(t,e,n,i){let s="";if(""===t||"None"===t)s="Not Collected";else{if(t.startsWith("<i"))return"<i  class='mdi mdi-playlist-check collected-icon'></i> Collected";s="<i  class='mdi mdi-playlist-check collected-icon'></i> Collected"}return s}},searchPanes:{header:"Collected",orthogonal:"sort",type:"html",dtOpts:{searching:!1,order:[[0,"asc"]]}}},{targets:[1,5],visible:!1,searchable:!1},{targets:3,type:"html",className:"keysColumn",visible:i,searchable:i,render:{display:function(t,e,n,i){return addKbdTags(t)},filter:function(t,e,n,i){return t}}},{targets:4,type:"html",visible:n,searchable:n,className:"keysColumn",render:{display:function(t,e,n,i){return addKbdTags(t)},filter:function(t,e,n,i){return t}}},{targets:6,visible:!1},{targets:7,visible:!1,searchable:!1,data:function(t,e,n,i){return extractModifiers(t[s])},type:"key-combination",searchPanes:{header:"Modifiers",dtOpts:{searching:!1,order:[[0,"asc"]]}}}],initComplete:function(t,e){$("#table_length > label").append(' | <span id="selectedcount">0</span> selected'),document.getElementById("tablerow").style.visibility="visible",$("#table").data("keyRetrieval",s),initVisualKeyboard();let n=t.oInstance.api();$(".system-switcher").removeClass("active"),n.column(4).visible()&&!n.column(3).visible()?($("#chooseMac").addClass("active"),s=4):n.column(3).visible()&&!n.column(4).visible()?($("#chooseWindows").addClass("active"),s=3):n.column(3).visible()&&n.column(4).visible()&&$("#chooseAll").addClass("active")}};return"undefined"!=typeof tableConfigMods&&Object.assign(a,tableConfigMods),$("#table").DataTable(a)}function updatedMasteredCount(t){let e=t.column("confidence:name").data().filter((function(t,e){return t>2})).length;$("#masterednumber").html(e),$("#totalnumber").html(t.rows().count())}function createGroupByButton(t,e,n){return{text:e,attr:{id:e+"groupByBtn"},action:function(e,i,s,o){if($(s).toggleClass("active"),$(s).hasClass("active"))n.push(t);else{const e=n.indexOf(t);e>-1&&n.splice(e,1)}n.length>0?(i.rowGroup().dataSrc(n),i.rowGroup().enable().draw(!1)):(i.rowGroup().dataSrc(n),i.rowGroup().enable(!1).draw(!1))}}}function createSearchPaneSettings(t){return{layout:"columns-1",columns:t,dataLength:80,cascadePanes:!0,threshold:10,dtOpts:{searching:!1}}}const combinationDataIndices={Context:4,Category:5,Collection:8,Module:8,Lesson:9};function initAjaxSourcedCollectionTable(t,e){let n=e.showMac?3:2,s=[],o=e.hasSubscription||e.enableVisualizer,a=[visualizerButton,basicTableButtons,{extend:"collection",text:"Group by",attr:{title:"Visually group rows by context and/or category"},buttons:e.rowGroupColumnNames.map(t=>createGroupByButton(combinationDataIndices[t],t,s))}];e.hasSubscription?a.push(exportbuttons):a.push(noSubscriptionExportButton);let r={searchHighlight:!0,language:languageSettings,iDisplayLength:25,lengthMenu:[[25,50,100,200],[25,50,100,200]],dom:collectionTableDom,select:selectMode,ajax:{url:e.ajaxUrl,dataSrc:""},searchPanes:createSearchPaneSettings(e.searchPaneColumns),buttons:{dom:{button:{tag:"button",className:"btn btn-outline-primary"}},buttons:a},rowGroup:{enable:!1},stateSave:!0,stateDuration:0,stateSaveParams:function(t,e){for(e.group=s,e.search.search="",e.searchPanes=[],i=0;i<e.columns.length;i++)e.columns[i].search.search=""},stateLoaded:function(t,e){s=e.group},initComplete:function(t,i){$("#table_length > label").append(' | <span id="selectedcount">0</span> selected'),document.getElementById("tablerow").style.visibility="visible",s.length>0&&(t.oInstance.api().rowGroup().dataSrc(s),t.oInstance.api().rowGroup().enable().draw(!1));let a=t.oInstance.api();e.updateMasteredCount&&updatedMasteredCount(a),o&&($("#table").data("keyRetrieval",n),initVisualKeyboard())},rowId:function(t){return"row"+t[0]}};return void 0!==t&&Object.assign(r,t),$("#table").DataTable(r)}function removeSelectedCombinations(t){let e=getCol(t.rows({selected:!0}).data(),0);if(0===e.length)return void notification_app.makeToast(!1,"warning","Warning","None selected");if(!confirm("Do you really want to delete "+e.length+" selected combinations? This cannot be undone."))return;removeCombinations(e,(function(e){let n=e.num_processed;for(notification_app.makeToast(!1,"success","Success","Removed "+n+" combination(s) from personal collection."),i=0;i<e.ids.length;i++)t.row("#row"+e.ids[i]).remove();rebuildSearchpanes(t),updatedMasteredCount(t),$(".selectionActionButton").prop("disabled",!0),mapperApp&&mapperApp.rebuild()}),(function(t,e,n){notification_app.makeToast(!1,"error","Error","Failed to delete combination(s).")}))}function removeSelectedTestRuns(t){let e=getCol(t.rows({selected:!0}).data(),0);if(0!==e.length){if(!confirm(`Do you really want to delete ${e.length} selected practice runs? This cannot be undone. Deleted practice runs are gone forever and will no longer be considered for confidence values.`))return;deleteTestRuns(e,(function(e){for(i=0;i<e.data.deleted_ids.length;i++)t.row("#row"+e.data.deleted_ids[i]).remove();t.draw(),$(".selectionActionButton").prop("disabled",!0),notification_app.makeToast(!1,"success","Success",e.data.message)}),(function(t){alert(t)}))}else notification_app.makeToast(!1,"warning","Warning","None selected")}function rebuildSearchpanes(t){let e=t.page();t.searchPanes.rebuildPane(void 0,!0),t.page(e).draw("page")}function collectionOperationCallback(t){let e,n;t.created?(e=new Array(8),e[0]=t.id):(n=table.row("#row"+t.id),e=n.data()),e[1]=t.description,e[2]=t.keys,e[3]=t.mac_keys,e[4]=t.context,e[5]=t.category,t.created&&(e[6]=0),t.created?(table.row.add(e).node().id="row"+t.id,rebuildSearchpanes(table),notification_app.makeToast(!1,"success","Success","Added key combination! ("+t.description+")")):(n.data(e),rebuildSearchpanes(table),notification_app.makeToast(!1,"success","Success","Updated key combination! ("+t.description+")")),mapperApp&&mapperApp.rebuild()}function addBulkEditButtonHandlers(){$(document).on("click","#bulkEditSelectedButton",(function(){if(!table.rows(".selected").any())return void notification_app.makeToast(!1,"warning","Warning","None selected");let t=getCol(table.rows({selected:!0}).data(),0);$(this).modalFormAsync({formURL:"/collecting/combinations/"+t.join("-")+"/bulk/edit/",callback:t=>{for(i=0;i<t.ids.length;i++){let e=table.row("#row"+t.ids[i]),n=e.data();t.updatedContext&&(n[4]=t.context),t.updatedCategory&&(n[5]=t.category),e.data(n)}table.draw(!1).searchPanes.rebuildPane(void 0,!0),notification_app.makeToast(!1,"success","Success",`Updated ${t.num_processed} combinations.`)}})}))}function addPracticeSelectedButtonHandlers(){$(document).on("click","#practiceSelectedButton",(function(){if(!table.rows(".selected").any())return void notification_app.makeToast(!1,"warning","Warning","None selected");let t=getCol(table.rows({selected:!0}).data(),0);window.location.href="/training/practice/selection/"+t.join("-")+"/"})),Mousetrap2.bind("shift+alt+p",(function(t){t.preventDefault(),t.stopPropagation(),$("#practiceSelectedButton").click()}))}function addRemoveSetButtonHandlers(){$(document).on("click","#removeset",(function(){removeSelectedCombinations(table)}))}function addEditCombinationHandlers(){$("#table").on("click",".edit-combination",(function(){$(this).modalFormAsync({formURL:"/collecting/combinations/"+$(this).data("id")+"/edit/",callback:collectionOperationCallback})}))}function createColumns(t){let e=t.showMacColumn?3:2,n=[{data:0,title:"ID",visible:!1},{data:1,title:"Description",render:$.fn.dataTable.render.text()},{data:2,title:"Keys",type:"html",className:"keysColumn",visible:t.showWinLinuxColumn,searchable:t.showWinLinuxColumn,render:{display:function(t,e,n,i){return addKbdTags(t)+addWarnIfInvalid(t)}}},{data:3,type:"html",title:"Keys (macOS)",visible:t.showMacColumn,searchable:t.showMacColumn,className:"keysColumn",render:{display:function(t,e,n,i){return addKbdTags(t)+addWarnIfInvalid(t)}}}];return t.includeContext&&n.push({title:"Context",data:4}),t.includeCategory&&n.push({title:"Category",data:5}),t.includeLesson&&n.push({data:9,title:"Lesson"}),t.includeCollection?n.push({data:8,title:"Collection"}):t.includeModule&&n.push({data:8,title:"Module",className:"text-right"}),t.includeLastPracticed&&n.push({data:9,title:"Practiced"}),n.push({title:"Modifiers",targets:4,visible:!1,searchable:!1,data:function(t,n,i,s){return extractModifiers(t[e])},type:"key-combination",searchPanes:{header:"Modifiers",dtOpts:{searching:!1,order:[[0,"asc"]]}}}),t.includeConfidence&&n.push({data:6,type:"num",name:"confidence",title:"Conf.",width:"40px",className:"text-right",createdCell:function(t,e,n,i,s){e>2?$(t).addClass("table-success"):e<0&&$(t).addClass("table-danger")}}),t.includeActions&&n.push({data:function(e,n,i,s){let o="";return t.hasPersonalFlagPerCombination&&!e[10]||(o+=`<button type="button" class="edit-combination icon-button btn-xs" data-toggle="tooltip"\n                        title="Edit Key Combination"\n                        data-id="${e[0]}">\n                  <i class="mdi mdi-square-edit-outline" aria-hidden="true"></i>\n                </button>`),e[7]>0&&(o+=`<a type="button"\n                     href='/collecting/combination-statistics/${e[0]}/'\n                     class="icon-button btn-xs" style="color: inherit" data-toggle="tooltip"\n                     title="Statistics (${e[7]} stats)">\n                    <i class="mdi mdi-chart-bar"></i>\n                  </a>`),o},targets:n.length,width:"60px",title:"Actions",type:"html"}),n}function initAjaxSourcedCollectionPage(t,e,n){$(document).ready((function(){prepareDataTable(),function(e,i=null){t(i),postInitCombinationDataTable(e,$("#table"),n.isPersonal)}(table=initAjaxSourcedCollectionTable(e,n))}))}var keyboardMap,notification_app=new Vue({el:"#notifications",data:{dismissSecs:1e3,dismissCountDown:0,showDismissibleAlert:!1,toastCount:0},methods:{makeToast(t=!1,e=null,n,i){this.toastCount++,this.$bvToast.toast(i,{title:n,autoHideDelay:1e4,variant:e,appendToast:t})}}}),mapperApp=void 0;function escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function getLabelForKeyBoard(t){let e=t.toUpperCase();return 1===e.length?e:t}function getKeyFromMap(t){if(keyboardMap){let e=keyboardMap.get(t);return e||t}return t}const visualizerButton={text:' <i class="mdi mdi-keyboard-variant"></i>',attr:{title:"Show/Hide Collection Visualizer (Virtual Keyboard)",id:"toggleKeyboardButton"},action:function(t,e,n,i){mapperApp?mapperApp.toggleVisibility():notification_app.makeToast(!1,"warning","Pro required","Upgrade to a Pro subscription to visualize personal collections and lessons via a virtual keyboard. For shared collections, only the owner needs a subscription.")}};function initVisualKeyboard(){mapperApp||(mapperApp=new Vue({delimiters:["[[","]]"],el:"#keyboardVisualizer",data:{showMapper:!sessionStorage.getItem("personalKeyboardHidden")&&window.innerWidth>1200,forceDisplay:!1},methods:{rebuild:function(){let t=this.$refs.keyboard;this.showMapper&&t&&t.refreshTableData()},silentHide:function(){this.showMapper=!1},toggleVisibility:function(){this.forceDisplay=!0,this.showMapper=!this.showMapper,this.showMapper?sessionStorage.removeItem("personalKeyboardHidden"):sessionStorage.setItem("personalKeyboardHidden",!0)}},watch:{showMapper(t){t||this.$refs.keyboard.clearTableFilter()}}}))}function initialItemsState(){let t={esc:{label:"Esc",modCombos:new Map,combinations:[]},f1:{label:"F1",modCombos:new Map,combinations:[]},f2:{label:"F2",modCombos:new Map,combinations:[]},f3:{label:"F3",modCombos:new Map,combinations:[]},f4:{label:"F4",modCombos:new Map,combinations:[]},f5:{label:"F5",modCombos:new Map,combinations:[]},f6:{label:"F6",modCombos:new Map,combinations:[]},f7:{label:"F7",modCombos:new Map,combinations:[]},f8:{label:"F8",modCombos:new Map,combinations:[]},f9:{label:"F9",modCombos:new Map,combinations:[]},f10:{label:"F10",modCombos:new Map,combinations:[]},f11:{label:"F11",modCombos:new Map,combinations:[]},f12:{label:"F12",modCombos:new Map,combinations:[]},tab:{label:"&#8677;",modCombos:new Map,combinations:[]},capslock:{label:"&#8682;",modCombos:new Map,combinations:[]},enter:{label:"&crarr;",modCombos:new Map,combinations:[]},ctrl:{label:"Ctrl",modCombos:new Map,combinations:[]},cmd:{label:getSuperKeyLabel(),modCombos:new Map,combinations:[]},alt:{label:"Alt",modCombos:new Map,combinations:[]},shift:{label:"&#8679;",modCombos:new Map,combinations:[]},space:{label:"Space",modCombos:new Map,combinations:[]},up:{label:"&uarr;",modCombos:new Map,combinations:[]},right:{label:"&rarr;",modCombos:new Map,combinations:[]},down:{label:"&darr;",modCombos:new Map,combinations:[]},left:{label:"&larr;",modCombos:new Map,combinations:[]},home:{label:"Home",modCombos:new Map,combinations:[]},end:{label:"End",modCombos:new Map,combinations:[]},pageup:{label:"Page &uarr;",modCombos:new Map,combinations:[]},pagedown:{label:"Page &darr;",modCombos:new Map,combinations:[]},del:{label:"Del",modCombos:new Map,combinations:[]},ins:{label:"Ins",modCombos:new Map,combinations:[]},backspace:{label:"&larr;",modCombos:new Map,combinations:[]}};return keyboardMap.forEach((e,n,i)=>{t[e]={label:getLabelForKeyBoard(e),modCombos:new Map,combinations:[]}}),t}Vue.component("kbdBtn",{delimiters:["[[","]]"],props:["item","itemKey"],template:'\n        <button v-bind:class="[$parent.computeClass(item), {\'hascombos\': item.combinations.length > 0 }, {\'filterbutton\': itemKey === $parent.tableFilterKey}]"\n                v-on:click="$parent.filter(itemKey);">\n            <span class="label" v-html="item.label"></span><span\n                v-bind:class="[\'conflict-label\', {\'text-danger\': $parent.hasConflict(item)}]">[[item.combinations.length]]</span>\n            <div class="keyitems" style="display: block;">\n                <div v-for="combination in item.combinations" class="shortcut"\n                     v-show="$parent.showCombination(combination)">\n                    [[combination.description]]\n                </div>\n                <div class="conflict-shortcut align-middle">\n                    Conflict\n                </div>\n            </div>\n        </button>\n    '}),Vue.component("kbdBtn2",{delimiters:["[[","]]"],props:["keyCode"],computed:{item(){return this.$parent.items[getKeyFromMap(this.keyCode)]}},template:'\n        <button v-bind:class="[$parent.computeClass(item), {\'hascombos\': item.combinations.length > 0 }, {\'filterbutton\': item.label === $parent.tableFilterKey}]"\n                v-on:click="$parent.filter(item.label);">\n            <span class="label" v-html="item.label"></span><span\n                v-bind:class="[\'conflict-label\', {\'text-danger\': $parent.hasConflict(item)}]">[[item.combinations.length]]</span>\n            <div class="keyitems" style="display: block;">\n                <div v-for="combination in item.combinations" class="shortcut"\n                     v-show="$parent.showCombination(combination)">\n                    [[combination.description]]\n                </div>\n                <div class="conflict-shortcut align-middle">\n                    Conflict\n                </div>\n            </div>\n        </button>\n    '}),Vue.component("modifierBtn",{delimiters:["[[","]]"],props:["item","itemKey"],template:'\n        <button v-bind:class="[{\'mod-active\': $parent.$data[itemKey]}, \'mod-\' + itemKey, $parent.computeClassMod(item)]"\n                v-on:click="$parent.$data[itemKey]= !$parent.$data[itemKey]">\n            <span class="label" v-html="item.label"></span><span\n                v-bind:class="[\'conflict-label\', {\'text-danger\': $parent.hasConflict(item)}]">[[item.combinations.length]]</span>\n            <div class="keyitems" style="display: block;">\n                <div v-for="combination in item.combinations" class="shortcut"\n                     v-show="$parent.showCombination(combination)">\n                    [[combination.description]]\n                </div>\n                <div class="conflict-shortcut text-danger align-middle">\n                    Conflict\n                </div>\n            </div>\n        </button>\n    '}),Vue.component("keyboard",{delimiters:["[[","]]"],props:["descriptionColumn","forceDisplay"],data:function(){return{controlsActive:!1,tableFilterKey:null,considerFilter:!1,ctrl:!1,alt:!1,shift:!1,cmd:!1,numSequences:0,keyColumn:3,numTextSnippets:0,numCombinations:0,numInvalidKeys:0,useDefaultLayout:!1,keyMap:void 0,customLayout:void 0,items:void 0}},created(){document.addEventListener("focusin",this.focusIn),document.addEventListener("focusout",this.focusOut)},beforeDestroy(){document.removeEventListener("focusin",this.focusIn),document.removeEventListener("focusout",this.focusOut)},computed:{modifierString:function(){let t="";return this.ctrl&&(t+="ctrl"),this.alt&&(t+="alt"),this.shift&&(t+="shift"),this.cmd&&(t+="cmd"),""===t&&(t="nomod"),t}},mounted:function(){navigator.keyboard.getLayoutMap().then(t=>{keyboardMap=t.size>0?t:new Map(Object.entries(getDefaultKeyMap())),this.useDefaultLayout=navigator.keyboard.layoutsNotSupported,this.items=initialItemsState(),this.processTableData()})},methods:{refreshTableData:function(){this.items=initialItemsState(),this.numCombinations=0,this.numSequences=0,this.numInvalidKeys=0,this.numTextSnippets=0,this.processTableData()},processTableData:function(){this.keyColumn=$("#table").data("keyRetrieval");let t=new Map,e=this,n={};if(this.considerFilter&&(n.search="applied"),table.rows(n).every((function(n,i,s){let o=this.data(),a=o[e.descriptionColumn],r=o[e.keyColumn];if(r.startsWith('"')&&r.endsWith('"'))return void(e.numTextSnippets+=1);let d=splitKeys(r);for(let n=0;n<d.length;n++){if(d[n].includes(" ")){e.numSequences+=1;continue}let i=extractModifiersAndKey(d[n]),s=i[0].replace("plus","+");if(e.items.hasOwnProperty(s)){e.items[s].combinations.push({description:a,modifiers:i[1]});let n=t.get(i[2]);void 0===n?t.set(i[2],1):t.set(i[2],n+1),e.numCombinations+=1,e.items[s].modCombos.set(i[2],e.items[s].modCombos.has(i[2]))}else e.numInvalidKeys+=1}})),t.size>0){let e=[...t.entries()].reduce((t,e)=>e[1]>t[1]?e:t)[0];this.ctrl=!1,this.alt=!1,this.shift=!1,this.cmd=!1,e.includes("ctrl")&&(this.ctrl=!0),e.includes("alt")&&(this.alt=!0),e.includes("shift")&&(this.shift=!0),e.includes("cmd")&&(this.cmd=!0)}!this.forceDisplay&&this.numCombinations<1&&this.$emit("hide")},showCombination:function(t){return void 0!==t.modifiers&&(t.modifiers[0]===this.ctrl&&t.modifiers[1]===this.alt&&t.modifiers[2]===this.shift&&t.modifiers[3]===this.cmd)},hasConflict:function(t){for(let e of t.modCombos.values())if(e)return!0},clearTableFilter:function(){$("#table").DataTable().column(this.keyColumn).search("").draw(),this.tableFilterKey=null},visualizeCurrentRows:function(){this.considerFilter=!0,this.refreshTableData()},visualizeAllRows:function(){this.considerFilter=!1,this.refreshTableData()},toggleLayoutDetection:function(){navigator.keyboard.layoutsNotSupported?notification_app.makeToast(!1,"warning","Not supported","System keyboard layout detection is only supported with KeyCombiner Desktop and Chromium-based Browsers (Chrome, Edge, Vivaldi). Unfortunately, your browser does not provide the required API."):(this.useDefaultLayout=!this.useDefaultLayout,this.useDefaultLayout?(this.customLayout=keyboardMap,keyboardMap=new Map(Object.entries(getDefaultKeyMap()))):keyboardMap=this.customLayout,this.refreshTableData())},focusIn(t){this.controlsActive=!0},gainFocus(t){document.getElementById("ShiftLeft").focus()},focusOut(t){this.controlsActive=!1},userKeyDown:function(t){button=document.getElementById(t.code),null!=button&&(t.preventDefault(),button.click())},computeClassMod:function(t){if(this.ctrl||this.alt||this.shift||this.cmd)return"";let e=t.modCombos.get("nomod");return void 0===e?"none":e?"nomod activebtn conflict":"nomod activebtn"},computeClass:function(t){let e=this.modifierString,n=t.modCombos.get(e);return void 0===n?"none":n?e+" conflict activebtn":e+" activebtn"},filter:function(t){this.tableFilterKey!==t?(this.tableFilterKey=t,$("#table").DataTable().column(this.keyColumn).search("(^|[+ ])"+escapeRegExp(t.toLowerCase().replace("+","plus"))+"( or|$| )",!0,!1,!1).draw()):this.clearTableFilter()}},template:'\n        <div class="row mb-3">\n            <div class="col-lg-auto col-md-12 order-lg-2 m-lg-auto">\n                <div class="row">\n                    <div id="keyboard" v-if="items" class="mapper" v-on:keydown="userKeyDown">\n                        <div class="kbdrow">\n                            <kbdBtn itemKey="esc" v-bind:item="items[\'esc\']"></kbdBtn>\n                            <div style="width: 40px" class="spacer-key"></div>\n                            <kbdBtn itemKey="f1" v-bind:item="items[\'f1\']"></kbdBtn>\n                            <kbdBtn itemKey="f2" v-bind:item="items[\'f2\']"></kbdBtn>\n                            <kbdBtn itemKey="f3" v-bind:item="items[\'f3\']"></kbdBtn>\n                            <kbdBtn itemKey="f4" v-bind:item="items[\'f4\']"></kbdBtn>\n                            <div class="spacer-small"></div>\n                            <kbdBtn itemKey="f5" v-bind:item="items[\'f5\']"></kbdBtn>\n                            <kbdBtn itemKey="f6" v-bind:item="items[\'f6\']"></kbdBtn>\n                            <kbdBtn itemKey="f7" v-bind:item="items[\'f7\']"></kbdBtn>\n                            <kbdBtn itemKey="f8" v-bind:item="items[\'f8\']"></kbdBtn>\n                            <div class="spacer-small"></div>\n                            <kbdBtn itemKey="f9" v-bind:item="items[\'f9\']"></kbdBtn>\n                            <kbdBtn itemKey="f10" v-bind:item="items[\'f10\']"></kbdBtn>\n                            <kbdBtn itemKey="f11" v-bind:item="items[\'f11\']"></kbdBtn>\n                            <kbdBtn itemKey="f12" v-bind:item="items[\'f12\']"></kbdBtn>\n                        </div>\n                        <div class="kbdrow">\n                            <div class="spacer-small"></div>\n                        </div>\n                        <div class="kbdrow">\n                            <kbdBtn2 v-bind:keyCode="\'Backquote\'">`</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit1\'">1</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit2\'">2</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit3\'">3</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit4\'">4</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit5\'">5</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit6\'">6</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit7\'">7</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit8\'">8</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit9\'">9</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Digit0\'">0</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Minus\'">-</kbdBtn2>\n                            <kbdBtn2 v-bind:keyCode="\'Equal\'">=</kbdBtn2>\n                            <kbdBtn style="width: 90px" itemKey="backspace"\n                                    v-bind:item="items[\'backspace\']"></kbdBtn>\n                            <div class="spacer-small"></div>\n                            <kbdBtn v-bind:itemKey="\'ins\'" v-bind:item="items[\'ins\']"></kbdBtn>\n                            <kbdBtn v-bind:itemKey="\'home\'" v-bind:item="items[\'home\']"></kbdBtn>\n                            <kbdBtn v-bind:itemKey="\'pageup\'" v-bind:item="items[\'pageup\']"></kbdBtn>\n\n                        </div>\n                        <div class="kbdrow">\n                            <div class="kbdcol">\n                                <div class="kbdrow">\n                                    <kbdBtn v-bind:itemKey="\'tab\'" style="width: 72px"\n                                            v-bind:item="items[\'tab\']"></kbdBtn>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyQ\'">Q</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyW\'">W</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyE\'">E</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyR\'">R</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyT\'">T</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyY\'">Y</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyU\'">U</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyI\'">I</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyO\'">O</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyP\'"></kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'BracketLeft\'"></kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'BracketRight\'"></kbdBtn2>\n                                    <kbdBtn2 style="width: 70px" v-bind:keyCode="\'Backslash\'"></kbdBtn2>\n                                    <div class="spacer-small"></div>\n                                    <kbdBtn v-bind:itemKey="\'del\'" v-bind:item="items[\'del\']"></kbdBtn>\n                                    <kbdBtn v-bind:itemKey="\'end\'" v-bind:item="items[\'end\']"></kbdBtn>\n                                    <kbdBtn v-bind:itemKey="\'pagedown\'" v-bind:item="items[\'pagedown\']"></kbdBtn>\n                                </div>\n                                <div class="kbdrow">\n                                    <kbdBtn style="width: 88px" itemKey="capslock"\n                                            v-bind:item="items[\'capslock\']"></kbdBtn>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyA\'">A</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyS\'">S</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyD\'">D</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyF\'">F</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyG\'">G</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyH\'">H</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyJ\'">J</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyK\'">K</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyL\'">L</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'Semicolon\'">;</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'Quote\'">\'</kbdBtn2>\n                                    <kbdBtn itemKey="enter" v-bind:item="items[\'enter\']"\n                                            style="width: 109px"></kbdBtn>\n                                    <div class="spacer-small"></div>\n                                    <div class="spacer-key"></div>\n                                    <div class="spacer-key"></div>\n                                    <div class="spacer-key"></div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="kbdrow">\n                            <div class="kbdcol">\n                                <div class="kbdrow">\n                                    <modifierBtn id="ShiftLeft" style="width: 71px" itemKey="shift"\n                                                 v-bind:item="items[\'shift\']"></modifierBtn>\n                                    <kbdBtn2 v-bind:keyCode="\'IntlBackslash\'">|</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyZ\'">Z</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyX\'">X</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyC\'">C</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyV\'">V</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyB\'">B</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyN\'">N</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'KeyM\'">M</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'Comma\'">,</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'Period\'">.</kbdBtn2>\n                                    <kbdBtn2 v-bind:keyCode="\'Slash\'">/</kbdBtn2>\n                                    <modifierBtn id="ShiftRight" style="width: 126px" itemKey="shift"\n                                                 v-bind:item="items[\'shift\']"></modifierBtn>\n\n                                    <div class="spacer-small"></div>\n                                    <div class="spacer-key"></div>\n                                    <kbdBtn itemKey="up" v-bind:item="items[\'up\']"></kbdBtn>\n                                    <div class="spacer-key"></div>\n                                </div>\n\n                                <div class="kbdrow">\n                                    <modifierBtn id="ControlLeft" style="width: 82px" itemKey="ctrl"\n                                                 v-bind:item="items[\'ctrl\']"></modifierBtn>\n                                    <template v-if="isMac">\n                                        <modifierBtn id="AltLeft" style="width: 68px" itemKey="alt"\n                                                     v-bind:item="items[\'alt\']"></modifierBtn>\n                                        <modifierBtn id="MetaLeft" style="width: 68px" itemKey="cmd"\n                                                     v-bind:item="items[\'cmd\']"></modifierBtn>\n                                    </template>\n                                    <template v-else>\n                                        <modifierBtn id="MetaLeft" style="width: 68px" itemKey="cmd"\n                                                     v-bind:item="items[\'cmd\']"></modifierBtn>\n                                        <modifierBtn id="AltLeft" style="width: 68px" itemKey="alt"\n                                                     v-bind:item="items[\'alt\']"></modifierBtn>\n                                    </template>\n                                    <kbdBtn itemKey="space" style="width: 306px"\n                                            v-bind:item="items[\'space\']"></kbdBtn>\n\n\n                                    <template v-if="isMac">\n                                        <modifierBtn id="MetaRight" style="width: 68px" itemKey="cmd"\n                                                     v-bind:item="items[\'cmd\']"></modifierBtn>\n                                        <modifierBtn id="AltRight" style="width: 68px" itemKey="alt"\n                                                     v-bind:item="items[\'alt\']"></modifierBtn>\n                                    </template>\n                                    <template v-else>\n                                        <modifierBtn id="AltRight" style="width: 68px" itemKey="alt"\n                                                     v-bind:item="items[\'alt\']"></modifierBtn>\n                                        <modifierBtn id="MetaRight" style="width: 68px" itemKey="cmd"\n                                                     v-bind:item="items[\'cmd\']"></modifierBtn>\n                                    </template>\n\n\n                                    <button id="ContextMenu"></button>\n                                    <modifierBtn id="ControlRight" style="width: 72px" itemKey="ctrl"\n                                                 v-bind:item="items[\'ctrl\']"></modifierBtn>\n                                    <div class="spacer-small"></div>\n                                    <kbdBtn v-bind:itemKey="\'left\'" v-bind:item="items[\'left\']"></kbdBtn>\n                                    <kbdBtn v-bind:itemKey="\'down\'" v-bind:item="items[\'down\']"></kbdBtn>\n                                    <kbdBtn v-bind:itemKey="\'right\'" v-bind:item="items[\'right\']"></kbdBtn>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n                <div class="row mt-2 mb-3">\n                    <button v-show="controlsActive" class="btn btn-outline-primary btn-sm mr-2"\n                            style="width: 120px"\n                            title="While the keyboard is in focus, you can press modifier keys to active them."\n                            v-on:click="document.activeElement.blur()">Lose Focus\n                    </button>\n                    <button v-show="!controlsActive" v-on:click="gainFocus()"\n                            class="btn btn-outline-primary btn-sm mr-2"\n                            style="width: 120px"\n                            title="While the keyboard is in focus, you can press modifier keys to active them.">\n                        Gain Focus\n                    </button>\n                    <button style="width: 120px"\n                            class="btn btn-outline-primary btn-sm mr-2"\n                            v-bind:title="useDefaultLayout ? \'Detect and use system layout\' : \'Use default layout instead of detected system layout\'"\n                            v-on:click="toggleLayoutDetection()">\n                        [[ useDefaultLayout ? \'System Layout\' : \'Default Layout\' ]]\n                    </button>\n                    <button class="btn btn-outline-primary btn-sm mr-2" style="width: 40px"\n                            v-on:click="visualizeCurrentRows()"\n                            title="Visualize the rows that are currently visible in the collection table.">\n                        <i class="mdi mdi-filter" aria-hidden="true"></i>\n                    </button>\n                    <button class="btn btn-outline-primary btn-sm mr-4" style="width: 40px"\n                            v-on:click="visualizeAllRows()" title="Visualize entire collection.">\n                        <i class="mdi mdi-filter-remove" aria-hidden="true"></i>\n                    </button>\n                    <span class="small align-middle">Mapped [[numCombinations]] combinations. Skipped [[numSequences]] sequences, [[numTextSnippets]] text snippets, and [[numInvalidKeys]] invalid keys.</span>\n                </div>\n            </div>\n        </div>\n    '}),Vue.component("publicbrowser",{delimiters:["[[","]]"],props:["categoryData"],data:function(){return{search:""}},computed:{filteredList(){let t=[];for(const[e,n]of Object.entries(this.categoryData))for(let e=0;e<n.length;e++)n[e].title.toLowerCase().includes(this.search.toLowerCase())&&t.push(n[e]);return t}},template:'\n            <div class="mt-4">\n                <div class="mt-4">\n                    <div class="input-group">\n                        <input type="text" class="form-control" v-model="search"\n                               @input="$event.target.composing = false"\n                               placeholder="Search for a collection...">\n                        <div class="input-group-append">\n                            <button v-on:click="search = \'\'" class="btn btn-outline-primary" type="button">X</button>\n                        </div>\n                    </div>\n                </div>\n                <div v-if="search === \'\'" class="category">\n                    <div v-for="(collections, key) in categoryData">\n                        <div class="row mt-5">\n                            <h2>[[ key ]]</h2>\n                        </div>\n                        <div class="row mt-3 justify-content-center justify-content-md-start">\n                            <div class="col-auto mb-3" v-for="collection in collections">\n                                <div class="card" style="width: 11rem; height: 10rem;">\n                                    <div class="text-center">\n                                        <img class="card-img-top"\n                                             style="padding: 10%; height: 100px; width: auto;"\n                                             v-bind:src="collection.img"\n                                             v-bind:alt="collection.title + \' logo\'">\n                                    </div>\n                                    <div class="card-body px-1 align-items-center d-flex justify-content-center">\n                                        <a v-bind:href="collection.link" class="stretched-link"><h5\n                                                class="card-title text-center">[[collection.title]]</h5></a>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div v-else class="row mt-5 justify-content-center justify-content-md-start">\n                    <div class="col-auto mb-3" v-for="collection in filteredList">\n                        <div class="card" style="width: 11rem; height: 10rem;">\n                            <div class="text-center">\n                                <img class="card-img-top" style="padding: 10%; height: 100px; width: auto;"\n                                     v-bind:src="collection.img"\n                                     v-bind:alt="collection.title + \' logo\'">\n                            </div>\n                            <div class="card-body px-1 align-items-center d-flex justify-content-center">\n                                <a v-bind:href="collection.link" class="stretched-link"><h5\n                                        class="card-title text-center">[[collection.title]]</h5></a>\n                            </div>\n                        </div>\n                    </div>\n                    <div class="col-auto" v-if="filteredList.length ===0">\n                        <h2>No Results</h2>\n                        <p class="lead">If you feel like we should add a collection for <i>[[search]]</i>, please <a\n                                href="mailto:support@keycombiner.com">drop us a line</a> and we will add your vote.</p>\n                    </div>\n                </div>\n            </div>\n        '}),Vue.component("trainingKbdBtn",{delimiters:["[[","]]"],props:["itemKey"],template:'\n        <button v-bind:id="itemKey">[[keyboardMap.get(itemKey)]]</button>\n    '});const keyDisplayMode={show:1,showWithDelay:2,hide:4},errorHandlingMode={ignore:1,goToNext:2,stayAndCountError:4},combinationResult={correct:1,skipped:2,error:4};function randomInteger(t,e=-1){let n=0;for(let i=0;i<3;i++){if(n=t[Math.floor(Math.random()*t.length)],n!==e)return n}return n}Vue.component("trainer",{delimiters:["[[","]]"],data:function(){return{currentlyDisplayed:[{absoluteIndexDisplayed:0,cssClass:"active-combination-card",keysVisible:!1,innerborderclass:"inner-active-combination-card"},{absoluteIndexDisplayed:1,cssClass:"inactive-combination-card",keysVisible:!1,innerborderclass:"inner-inactive-combination-card"},{absoluteIndexDisplayed:2,cssClass:"inactive-combination-card",keysVisible:!1,innerborderclass:"inner-inactive-combination-card"},{absoluteIndexDisplayed:3,cssClass:"inactive-combination-card",keysVisible:!1,innerborderclass:"inner-inactive-combination-card"}],keyMap:!1,config:training_config,origTime:training_config.time,absoluteIndex:0,key_string:"",input_text:"",mousetrap_training_instance:null,mousetrap_preventer_instance:null,default_key_handle_preventer:null,default_key_handle_trainer:null,hasCurrentError:!1,training_combinations:key_combinations,combosTypedWithError:[],combosConfidenceChanged:[],total_score:0,updatedMasteredCount:"n/A",total_with_hints:0,total_skipped:0,averageOfAverages:0,total_error:0,current_start_time:null,totalStartTime:null,timeInterval:null,keysVisible:!1,currentIsTextSnippet:!1,finished:!1,savedStatistics:!1,testRunUrl:"",orderedIndices:[],selected:"",previousSequenceLevel:0,arrayToPick:[],totalTime:60}},watch:{finished:{handler:function(t,e){this.completed(),this.buildPlot(),setTimeout(()=>{this.$refs.restartButton.focus()},500)}},"config.keyDetectionMode"(t){this.mousetrap_preventer_instance.setKeyDetectionMode(t),this.mousetrap_training_instance.setKeyDetectionMode(t)}},computed:{currentChars:function(){return makeReplacements(this.training_combinations[this.orderedIndices[this.absoluteIndex]].keys,this.config.aliases).split(/[ +]+/)}},methods:{buildPlot:function(){let t={labels:[],num_correct:[],num_error:[],num_skipped:[],num_correct_with_keys:[],average_time:[],description:[],xAxisHref:[]},e=this.training_combinations.length;for(i=0;i<e;i++)this.training_combinations[i].num_correct+this.training_combinations[i].num_correct_with_keys+this.training_combinations[i].num_error+this.training_combinations[i].num_skipped<1||(t.labels.push(this.training_combinations[i].description),t.num_correct.push(this.training_combinations[i].num_correct),t.num_error.push(this.training_combinations[i].num_error),this.training_combinations[i].num_error>0&&this.combosTypedWithError.push({description:this.training_combinations[i].description,keys:this.training_combinations[i].keys,id:this.training_combinations[i].id}),t.num_skipped.push(this.training_combinations[i].num_skipped),t.num_correct_with_keys.push(this.training_combinations[i].num_correct_with_keys),t.average_time.push(this.training_combinations[i].elapsed_time.reduce((t,e)=>t+e,0)/this.training_combinations[i].elapsed_time.length),t.description.push(this.training_combinations[i].keys),t.xAxisHref.push("/collecting/combination-statistics/"+this.training_combinations[i].id+"/"),createPracticeRunChart(t,document.getElementById("learningResultsChart"),!0))},computeAverageOfAverages:function(){let t=[];for(i=0;i<this.training_combinations.length;i++)this.training_combinations[i].elapsed_time&&this.training_combinations[i].elapsed_time.length>0&&t.push(this.training_combinations[i].elapsed_time.reduce((t,e)=>t+e,0)/this.training_combinations[i].elapsed_time.length);t.length>0?this.averageOfAverages=Math.round(t.reduce((t,e)=>t+e,0)/t.length/100)/10:this.averageOfAverages=0},addElapsedTime:function(){if(this.total_score+this.total_with_hints<=1)return;let t=new Date-this.current_start_time;this.training_combinations[this.orderedIndices[this.absoluteIndex]].elapsed_time.push(t),this.computeAverageOfAverages()},updateComboArrayById:function(t,e,n,i=!1){const s=n.findIndex(e=>e.id===t);if(s<0)return;let o=n[s];o.keys=isMac?e.mac_keys:e.keys,i&&!isValidCombination(o.keys)?n.splice(s,1):o.description=e.description},editCombination:function(t){$(document).modalFormAsync({formURL:`/collecting/combinations/${t.id}/edit/limited/`,callback:e=>{this.updateComboArrayById(t.id,e,key_combinations,!0),this.updateComboArrayById(t.id,e,this.combosTypedWithError),this.updateComboArrayById(t.id,e,this.combosConfidenceChanged)}})},gameOver:function(){this.finished=!0,this.mousetrap_preventer_instance.handleKey=this.default_key_handle_preventer,this.mousetrap_training_instance.reset();let t=document.querySelectorAll("#keyboard button");for(let e=0;e<t.length;e++)t[e].className="";if(Mousetrap2.bind(splitKeys(this.training_combinations[this.orderedIndices[this.absoluteIndex]].keys,this.config.aliases),(function(t,e){t.preventDefault(),t.stopPropagation()})),!this.config.autosave)return;axios.defaults.xsrfCookieName="csrftoken",axios.defaults.xsrfHeaderName="X-CSRFTOKEN";let e=[];for(i=0;i<this.training_combinations.length;i++)(this.training_combinations[i].num_correct>0||this.training_combinations[i].num_correct_with_keys>0||this.training_combinations[i].num_error>0||this.training_combinations[i].num_skipped>0)&&e.push(this.training_combinations[i]);let n="/training/test-run/new/";this.config.isTest&&(n+="True/"),axios.post(n,{data:e,time:this.totalTime}).then(t=>{let e=t.data.confidence_change_combinations;e.sort((function(t,e){return Math.abs(e.old_confidence-e.new_confidence)-Math.abs(t.old_confidence-t.new_confidence)}));let n=t.data.net_diff;window.masteredCount=window.masteredCount+n,this.updatedMasteredCount=window.masteredCount+" / "+this.training_combinations.length,n>0?this.updatedMasteredCount+=" (+"+n+")":n<0&&(this.updatedMasteredCount+=" ("+n+")"),this.combosConfidenceChanged=e.slice(0,8),this.savedStatistics=!0,this.testRunUrl="/training/test-run/"+t.data.test_run_id+"/",notification_app.makeToast(!1,"success","Success",t.data.message),training_config.lesson&&axios.get(`/training/api/lesson/update/${training_config.lesson}/`).then(t=>{"newly_mastered"===t.data.status?notification_app.makeToast(!1,"success","Lesson Mastered",t.data.message):notification_app.makeToast(!1,"secondary","Info",t.data.message)}),training_config.isTest&&notification_app.makeToast(!1,"success","Review Completed","You successfully practiced today's combinations. Keep doing daily practice and your shortcut knowledge will grow quickly.")}).catch((function(t){notification_app.makeToast(!1,"danger","Error",t.response.data)}))},updateTime:function(){this.config.time--,0===this.config.time&&(clearInterval(this.timeInterval),this.config.isTest||this.gameOver())},combinationClass:function(t){return t.new_confidence>t.old_confidence?"successbackground":"errorbackground"},goToNextCombination:function(t=!0,e=combinationResult.correct){if(!this.config.isTest&&null==this.timeInterval&&this.config.time>0?this.timeInterval=setInterval(this.updateTime,1e3):this.config.isTest&&null===this.totalStartTime&&(this.totalStartTime=new Date),t&&(this.mousetrap_training_instance.reset(),this.mousetrap_training_instance.handleKey=this.default_key_handle_trainer),this.previousSequenceLevel=0,this.input_text="",this.absoluteIndex===this.currentlyDisplayed[3].absoluteIndexDisplayed){this.currentlyDisplayed[3].keysVisible=!0,this.currentlyDisplayed[0].absoluteIndexDisplayed=this.absoluteIndex+1,this.currentlyDisplayed[1].absoluteIndexDisplayed=this.absoluteIndex+2,this.currentlyDisplayed[2].absoluteIndexDisplayed=this.absoluteIndex+3,this.currentlyDisplayed[0].cssClass="active-combination-card",this.currentlyDisplayed[1].cssClass="inactive-combination-card",this.currentlyDisplayed[2].cssClass="inactive-combination-card",this.currentlyDisplayed[0].innerborderclass="inner-active-combination-card",this.currentlyDisplayed[1].innerborderclass="inner-inactive-combination-card",this.currentlyDisplayed[2].innerborderclass="inner-inactive-combination-card",this.currentlyDisplayed[0].wrongkeys="",this.currentlyDisplayed[1].wrongkeys="",this.currentlyDisplayed[2].wrongkeys="";let t=this.currentlyDisplayed[3];if(e===combinationResult.error?(t.cssClass="error-combination-card",t.innerborderclass="inner-error-combination-card"):e===combinationResult.skipped?(t.cssClass="skipped-combination-card",t.innerborderclass="inner-skipped-combination-card"):(t.cssClass="correct-combination-card",t.innerborderclass="inner-correct-combination-card"),this.config.keyDisplayMode==keyDisplayMode.show)this.currentlyDisplayed[0].keysVisible=!0,this.currentlyDisplayed[1].keysVisible=!0,this.currentlyDisplayed[2].keysVisible=!0;else if(this.config.keyDisplayMode==keyDisplayMode.showWithDelay){this.currentlyDisplayed[0].keysVisible=!1,this.currentlyDisplayed[1].keysVisible=!1,this.currentlyDisplayed[2].keysVisible=!1;const t=this.currentlyDisplayed[0].absoluteIndexDisplayed;setTimeout(()=>{this.currentlyDisplayed[0].keysVisible=this.currentlyDisplayed[0].keysVisible||this.currentlyDisplayed[0].absoluteIndexDisplayed===t},this.config.keyDisplaydelay)}else this.currentlyDisplayed[0].keysVisible=!1,this.currentlyDisplayed[1].keysVisible=!1,this.currentlyDisplayed[2].keysVisible=!1}else{this.absoluteIndex==this.currentlyDisplayed[0].absoluteIndexDisplayed&&(this.currentlyDisplayed[3].absoluteIndexDisplayed=this.absoluteIndex+3,this.currentlyDisplayed[3].cssClass="inactive-combination-card",this.currentlyDisplayed[3].wrongkeys="",this.currentlyDisplayed[3].innerborderclass="inner-inactive-combination-card",this.currentlyDisplayed[3].keysVisible=this.config.keyDisplayMode==keyDisplayMode.show);for(var n=0;n<3;n++)if(this.absoluteIndex==this.currentlyDisplayed[n].absoluteIndexDisplayed){if(this.currentlyDisplayed[n+1].cssClass="active-combination-card",this.currentlyDisplayed[n+1].innerborderclass="inner-active-combination-card",this.config.keyDisplayMode==keyDisplayMode.showWithDelay){this.currentlyDisplayed[n+1].keysVisible=!1;let t=n+1,e=this.currentlyDisplayed[t].absoluteIndexDisplayed;setTimeout(()=>{this.currentlyDisplayed[t].keysVisible=this.currentlyDisplayed[t].keysVisible||this.currentlyDisplayed[t].absoluteIndexDisplayed===e},this.config.keyDisplaydelay)}else this.currentlyDisplayed[n+1].keysVisible=!1;this.currentlyDisplayed[n].keysVisible=!0,e==combinationResult.error?(this.currentlyDisplayed[n].cssClass="error-combination-card",this.currentlyDisplayed[n].innerborderclass="inner-error-combination-card"):e==combinationResult.skipped?(this.currentlyDisplayed[n].cssClass="skipped-combination-card",this.currentlyDisplayed[n].innerborderclass="inner-skipped-combination-card"):(this.currentlyDisplayed[n].cssClass="correct-combination-card",this.currentlyDisplayed[n].innerborderclass="inner-correct-combination-card")}}if(this.config.isTest){if(this.absoluteIndex+1>=this.orderedIndices.length){const t=new Date;return this.totalTime=t-this.totalStartTime,this.totalTime=Math.max(Math.ceil(this.totalTime/1e3),1),void this.gameOver()}}else this.orderedIndices.push(randomInteger(this.arrayToPick,this.orderedIndices[this.orderedIndices.length-1]));++this.absoluteIndex,this.key_string=addKbdTags(this.training_combinations[this.orderedIndices[this.absoluteIndex]].keys),this.bindNextCombination()},handleSuccessFulCombination:function(){this.currentlyDisplayed[this.getCurrentDisplayIndex()].keysVisible||1==this.config.keyDisplayMode?(this.training_combinations[this.orderedIndices[this.absoluteIndex]].num_correct_with_keys++,this.total_with_hints++,this.addCurrentIndexToEnd()):(this.training_combinations[this.orderedIndices[this.absoluteIndex]].num_correct++,this.total_score++,this.addElapsedTime())},addCurrentIndexToEnd:function(){!this.config.isTest||this.orderedIndices[this.orderedIndices.length-1]==this.orderedIndices[this.absoluteIndex]&&this.absoluteIndex!=this.orderedIndices.length-1||this.orderedIndices.push(this.orderedIndices[this.absoluteIndex])},addError:function(){this.addCurrentIndexToEnd(),this.training_combinations[this.orderedIndices[this.absoluteIndex]].num_error++,this.total_error++},getCombinationByAbsolute:function(t){if(0==this.orderedIndices.length)return"";this.training_combinations.length;return this.training_combinations[this.orderedIndices[t]]},getKeysByAbsolute:function(t){if(0==this.orderedIndices.length)return"";this.training_combinations.length;return addKbdTags(this.training_combinations[this.orderedIndices[t]].keys)},prettifyKeys:function(t){if(void 0===t)return"";if(""==t)return t;return addKbdTags(t)},prettifyKeysErr:function(t){if(void 0===t)return"";if(""==t)return t;return addKbdTags(t)},getCurrentDisplayIndex:function(){for(var t=0;t<4;t++)if(this.absoluteIndex==this.currentlyDisplayed[t].absoluteIndexDisplayed)return t;return 0},isSequence:function(t){return!!t.replace(/\s+or\s+/g,"+").includes(" ")},outOfOrder:function(t,e){let n=!1;if(this.isSequence(t)){let t=Object.values(this.mousetrap_training_instance.getSequenceLevels())[0];t<=0&&this.previousSequenceLevel>0&&(n=!0),this.previousSequenceLevel=t}return n},prevent:function(t){this.input_text="";var e=this.training_combinations[this.orderedIndices[this.absoluteIndex]].keys;this.mousetrap_preventer_instance.handleKey=t?(t,n,i)=>{if(i.defaultPrevented)return;let s=null;if(i.repeat||"keydown"==i.type&&(s=document.getElementById(i.code),null!=s&&s.classList.add("activebutton")),"keydown"===i.type){if(!i.repeat){let i=this.currentChars,o=t,a=n.filter(t=>t!==o);if(a.push(o),isMac){let e=i.indexOf("meta");for(;e>-1;)i[e]="cmd",e=i.indexOf("meta");let n=a.indexOf("meta");for(;n>-1;)a[n]="cmd",n=a.indexOf("meta");o=t.replace(/meta/g,"cmd")}this.input_text=a.join("+").trim(),("CH"!=this.config.keyDetectionMode||"shift"!=o&&"altgraph"!=o)&&(!i.includes(o)||this.outOfOrder(e,o)?(null!=s&&s.classList.add("wrongbutton"),this.config.errorHandlingMode===errorHandlingMode.stayAndCountError?("active-combination-card-error"!==this.currentlyDisplayed[this.getCurrentDisplayIndex()].cssClass&&this.addError(),this.currentlyDisplayed[this.getCurrentDisplayIndex()].cssClass="active-combination-card-error",this.currentlyDisplayed[this.getCurrentDisplayIndex()].keysVisible=!0,this.currentlyDisplayed[this.getCurrentDisplayIndex()].wrongkeys=this.input_text):this.config.errorHandlingMode===errorHandlingMode.goToNext&&(this.currentlyDisplayed[this.getCurrentDisplayIndex()].wrongkeys=this.input_text,this.addError(),this.goToNextCombination(!0,combinationResult.error))):null!=s&&s.classList.add("correctbutton"))}i.preventDefault(),i.stopPropagation()}"keyup"===i.type&&(this.input_text="")}:this.default_key_handle_preventer},bindNextCombination:function(t=!0){this.current_start_time=new Date;let e=this.training_combinations[this.orderedIndices[this.absoluteIndex]].keys;e.startsWith('"')&&e.endsWith('"')?(this.prevent(!1),this.currentIsTextSnippet=!0,t&&void 0!==this.$refs.input&&this.$nextTick(()=>this.$refs.input.focus()),e=e.substring(1,e.length-1),this.mousetrap_training_instance.handleKey=(t,n,i)=>{let s=null;i.repeat||"keydown"===i.type&&"esc"!==t&&(s=document.getElementById(i.code),null!=s&&s.classList.add("activebutton"),keyIsModifier(i.key)||"AltGraph"===i.key||(isPrefixOfSnippet(e,this.input_text+i.key)?s.classList.add("correctbutton"):s.classList.add("wrongbutton"))),"keyup"===i.type&&(isPrefixOfSnippet(e,this.input_text)?isEqualTextSnippet(e,this.input_text)&&(this.hasCurrentError=!1,this.mousetrap_training_instance.handleKey=this.default_key_handle_trainer,this.handleSuccessFulCombination(),this.goToNextCombination(!1,combinationResult.correct)):(this.hasCurrentError||this.addError(),this.hasCurrentError=!0,this.currentlyDisplayed[this.getCurrentDisplayIndex()].cssClass="active-combination-card-error",this.currentlyDisplayed[this.getCurrentDisplayIndex()].keysVisible=!0))}):(this.currentIsTextSnippet=!1,t&&void 0!==this.$refs.input&&this.$nextTick(()=>this.$refs.input.focus()),this.mousetrap_training_instance.bind(splitKeys(this.training_combinations[this.orderedIndices[this.absoluteIndex]].keys,this.config.aliases),(t,e)=>{let n=document.getElementById(t.code);null!=n&&(n.classList.add("activebutton"),n.classList.add("correctbutton")),t.preventDefault(),t.stopPropagation(),this.handleSuccessFulCombination(),this.goToNextCombination(!0,combinationResult.correct),this.input_text=""},"keydown"),this.prevent(!0)),this.input_text=""},keyupButton:function(t){!isMac||"MetaRight"!==t.code&&"MetaLeft"!==t.code||setTimeout(()=>{let t=document.querySelectorAll("#keyboard button:not([id^=Meta])");for(let e=0;e<t.length;e++)t[e].className=""},100),button=document.getElementById(t.code),null!=button&&(button.classList.remove("activebutton"),button.classList.remove("correctbutton"),button.classList.remove("wrongbutton"))},skip:function(){this.training_combinations[this.orderedIndices[this.absoluteIndex]].num_skipped++,this.total_skipped++,this.goToNextCombination(!0,combinationResult.skipped)},refresh:function(){this.config.isTest?location.reload():(clearInterval(this.timeInterval),this.timeInterval=null,this.config.time=this.origTime,this.$emit("refresh",!0))},completed:function(){reEnableCommandBar(),this.$emit("completed",!0)}},mounted:function(){0===this.training_combinations.length&&location.reload(),navigator.keyboard.getLayoutMap().then(t=>{keyboardMap=t,this.keyMap=!0});let t=0,e=0;for(i=0;i<this.training_combinations.length;i++){this.training_combinations[i].elapsed_time=[],this.training_combinations[i].num_correct=0,this.training_combinations[i].num_correct_with_keys=0,this.training_combinations[i].num_error=0,this.training_combinations[i].num_skipped=0;let n=this.training_combinations[i].confidence_value;if(n>2&&(e+=1),this.config.isTest)this.arrayToPick.push(i);else if(null==n||n<1){if(t++<16)for(let t=0;t<6;t++)this.arrayToPick.push(i)}else if(n<2)for(let t=0;t<3;t++)this.arrayToPick.push(i);else if(n<4)for(let t=0;t<2;t++)this.arrayToPick.push(i);else this.arrayToPick.push(i)}if(void 0===window.masteredCount&&(window.masteredCount=e),this.config.isTest)for(const t of this.arrayToPick)this.orderedIndices.push(t);else this.orderedIndices.push(randomInteger(this.arrayToPick)),this.orderedIndices.push(randomInteger(this.arrayToPick,this.orderedIndices[this.orderedIndices.length-1])),this.orderedIndices.push(randomInteger(this.arrayToPick,this.orderedIndices[this.orderedIndices.length-1])),this.orderedIndices.push(randomInteger(this.arrayToPick,this.orderedIndices[this.orderedIndices.length-1])),this.orderedIndices.push(randomInteger(this.arrayToPick,this.orderedIndices[this.orderedIndices.length-1]));if(Mousetrap2(this.$refs.outer).bind("esc",t=>{if(this.training_combinations[this.orderedIndices[this.absoluteIndex]].keys.includes("esc"))return!0;t.preventDefault(),t.stopPropagation(),this.skip()},"keydown"),this.mousetrap_preventer_instance=new Mousetrap2(this.$refs.outer),this.default_key_handle_preventer=this.mousetrap_preventer_instance.handleKey,this.key_string=addKbdTags(this.training_combinations[this.orderedIndices[this.absoluteIndex]].keys),this.mousetrap_training_instance=new Mousetrap2(this.$refs.inputrow),this.default_key_handle_trainer=this.mousetrap_training_instance.handleKey,this.$refs.inputrow.addEventListener("focusout",()=>{reEnableCommandBar()}),this.$refs.inputrow.addEventListener("focusin",()=>{suppressCommandBar()}),this.mousetrap_preventer_instance.setKeyDetectionMode(this.config.keyDetectionMode),this.mousetrap_training_instance.setKeyDetectionMode(this.config.keyDetectionMode),this.bindNextCombination(!1),this.config.keyDisplayMode===keyDisplayMode.show)this.currentlyDisplayed[0].keysVisible=!0;else if(this.config.keyDisplayMode===keyDisplayMode.showWithDelay){this.currentlyDisplayed[0].keysVisible=!1;const t=this.currentlyDisplayed[0].absoluteIndexDisplayed;setTimeout(()=>this.currentlyDisplayed[0].keysVisible=this.currentlyDisplayed[0].keysVisible||this.currentlyDisplayed[0].absoluteIndexDisplayed===t,this.config.keyDisplaydelay)}else this.currentlyDisplayed[0].keysVisible=!1;this.currentlyDisplayed[1].keysVisible=!1,this.currentlyDisplayed[2].keysVisible=!1,this.currentlyDisplayed[3].keysVisible=!1},template:'\n        <div ref="outer" class="">\n            <div class="d-md-none">Please switch to a device with a larger screen and a keyboard to use KeyCombiner\'s\n                interactive trainer.\n            </div>\n            <div class="d-none d-md-block">\n                <div id="trainer" style="min-width: 760px" class="text-center">\n                    <div v-if="finished" class="row mt-3" id="summary">\n                        <div class="col-12 text-left">\n                            <h2 class="card-title">Practice Run Completed!</h2>\n                        </div>\n\n                        <div class="col-12">\n                            <div class="card">\n                                <div class="card-header">\n                                    Summary\n                                </div>\n                                <div class="card-body py-0 pl-2">\n                                    <table class="table m-0">\n                                        <tbody>\n                                        <tr>\n                                            <td>Collection Size</td>\n                                            <td>Correct</td>\n                                            <td>With Hints</td>\n                                            <td>Errors</td>\n                                            <td>Skipped</td>\n                                            <td> Time (s):</td>\n                                        </tr>\n                                        <tr>\n                                            <td>[[training_combinations.length]]</td>\n                                            <td><span class="rounded p-2 successbackground">[[total_score]]</span>\n                                            </td>\n                                            <td><span\n                                                    class="rounded p-2 withhintsbackground">[[total_with_hints]]</span>\n                                            </td>\n                                            <td><span class="rounded p-2 errorbackground">[[total_error]]</span>\n                                            </td>\n                                            <td><span class="rounded p-2 skippedbackground">[[total_skipped]]</span>\n                                            </td>\n                                            <td><span class="rounded p-2 timebackground">[[averageOfAverages]]</span>\n                                            </td>\n                                        </tr>\n                                        </tbody>\n                                    </table>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="col-12">\n                            <div class="card-deck my-3">\n                                <div class="card mb-2">\n                                    <div class="card-body">\n                                        <h5 class="card-title">Combinations per Minute</h5>\n                                        <h2 class="card-text">[[config.isTest ? Math.round( total_score * 60 /\n                                            totalTime) : total_score]]</h2>\n                                        <p class="card-text   text-left"><small class="text-muted">How many\n                                            combinations you typed correct and without hints per 60 seconds. (Total\n                                            time: [[totalTime]]s)</small></p>\n                                    </div>\n                                </div>\n                                <div class="card mb-2 ">\n                                    <div class="card-body">\n                                        <h5 class="card-title">Correct Percentage</h5>\n                                        <h2 class="card-text">[[ Math.round((total_score / absoluteIndex * 100))\n                                            ]] %</h2>\n                                        <p class="card-text  text-left"><small class="text-muted">The percentage\n                                            of combination occurences you\n                                            typed correct and without hints.</small></p>\n                                    </div>\n                                </div>\n                                <div class="card mb-2 " v-if="savedStatistics">\n                                    <div class="card-body">\n                                        <h5 class="card-title">Mastered</h5>\n                                        <h2 class="card-text">[[updatedMasteredCount]]</h2>\n                                        <p class="card-text  text-left"><small class="text-muted">Combinations in the\n                                            practiced set with confidence value > 2.</small></p>\n                                    </div>\n                                </div>\n                            </div>\n\n                            <div class="row justify-content-md-center">\n                                <div class="col-md-4">\n                                    <button type="button" class="btn btn-block btn-outline-primary"\n                                            ref="restartButton"\n                                            data-toggle="tooltip"\n                                            title="Restart"\n                                            v-on:click="refresh">\n                                        <i class="mdi mdi-refresh" aria-hidden="true"></i>\n                                        [[ config.isTest ? \'New Review\' : \'Restart\' ]]\n                                    </button>\n                                </div>\n                                <div v-show="savedStatistics" class="col-md-4">\n                                    <a v-bind:href="testRunUrl" class="btn btn-block\n                                        btn-outline-primary"><i class="mdi mdi-chart-bar"></i> Saved Statistics</a>\n                                </div>\n                            </div>\n                        </div>\n\n\n                    </div>\n                    <div id="inputcards" v-if="!finished">\n                        <div v-for="item in currentlyDisplayed.slice().reverse()">\n                            <div class="row mt-2 d-flex justify-content-center">\n                                <div style="min-height: 70px;" class="card align-items-center"\n                                     v-bind:class="item.cssClass">\n                                    <div class="row align-items-center h-100" v-bind:class="item.innerborderclass"\n                                         v-if="orderedIndices.length > item.absoluteIndexDisplayed">\n                                        <div class="col-2 mx-auto">\n                                            [[getCombinationByAbsolute(item.absoluteIndexDisplayed).context]]\n                                        </div>\n                                        <div class="col-5 mx-auto">\n                                            <h6 class="card-title mb-0">\n                                                [[getCombinationByAbsolute(item.absoluteIndexDisplayed).description]]</h6>\n                                        </div>\n                                        <div class="col-3 mx-auto">\n                                            <div class="smallkbd"\n                                                 v-show="item.keysVisible || config.keyDisplayMode==1"\n                                                 v-html="getKeysByAbsolute(item.absoluteIndexDisplayed)"></div>\n                                        </div>\n                                        <div class="col-2 mx-auto smallkbd kbderr align-middle">\n                                            <div class="" v-if="item.wrongkeys"\n                                                 v-html="prettifyKeysErr(item.wrongkeys)"></div>\n                                        </div>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                        <div class="row mt-4" ref="inputrow">\n                            <div class="col-12" v-on:keyup="keyupButton">\n                                <div class="input-group input-group-lg" ref="inputgroup">\n                                    <div class="input-group-prepend">\n                <span class="input-group-text" id="inputGroup-sizing-lg">Key Combination Input&nbsp;<i\n                        class="mdi mdi-keyboard-variant ml-2"></i></span>\n                                    </div>\n                                    <div id="training-input" v-if="!currentIsTextSnippet" ref="input"\n                                         v-html="prettifyKeys(input_text)"\n                                         class="form-control" contenteditable="true"></div>\n                                    <input v-else type="text" class="form-control" ref="input" id="training-input"\n                                           v-model="input_text">\n                                    <div class="input-group-append">\n                                        <span id="time" v-if="!config.isTest"\n                                              class="input-group-text">[[config.time]]</span>\n                                        <span id="time" v-else class="input-group-text">[[orderedIndices.length - absoluteIndex]]</span>\n                                    </div>\n                                    <div class="input-group-append">\n                                        <button type="button" class="btn btn-outline-primary btn-lg"\n                                                data-toggle="tooltip"\n                                                title="Skip this combination | Esc" v-on:click="skip">\n                                            <i class="mdi mdi-debug-step-over"></i>\n                                        </button>\n                                    </div>\n                                    <div class="input-group-append">\n                                        <button type="button" class="btn btn-outline-primary" data-toggle="tooltip"\n                                                title="Restart"\n                                                v-on:click="refresh">\n                                            <i class="mdi mdi-refresh" aria-hidden="true"></i>\n                                        </button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div v-if="combosTypedWithError.length" class="card my-2 border-0">\n                    <div class="card-body">\n                        <h5 class="card-title text-center">Mistyped</h5>\n                        <div class="card-deck my-2 justify-content-center">\n                            <div v-for="combination in combosTypedWithError" class="card mb-2"\n                                 style="max-width: 16rem;">\n                                <div class="card-body errorbackground">\n                                    <button type="button" class="edit-combination icon-button btn-xs"\n                                            v-if="combination.id"\n                                            style="position: absolute; right: 5px; bottom: 5px"\n                                            data-toggle="tooltip"\n                                            title="Edit Key Combination"\n                                            v-on:click="editCombination(combination)"><i\n                                            class="mdi mdi-square-edit-outline"\n                                            aria-hidden="true"></i></button>\n\n                                    <p v-if="combination.id" class="card-text"><a\n                                            :href="\'/collecting/combination-statistics/\' + combination.id + \'/\'">[[combination.description]]</a>\n                                    </p>\n                                    <p v-else>[[combination.description]]</p>\n                                    <p class="card-text" v-html=prettifyKeys(combination.keys)></p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n                <div v-if=" combosConfidenceChanged.length" class="card my-2 border-0">\n                    <div class="card-body">\n                        <h5 class="card-title text-center">Most Significant Confidence Changes</h5>\n                        <p class="text-center"><small class="text-muted">See how the saved results of this practice run\n                            contributed to the combinations\' confidence values. Combinations with confidence greater\n                            than 2 are mastered.</small></p>\n                        <div class="card-deck my-2 justify-content-center">\n                            <div v-for="combination in  combosConfidenceChanged" class="card mb-2"\n                                 v-bind:class="combinationClass(combination)"\n                                 style="max-width: 16rem;">\n                                <div class="card-body">\n                                    <button type="button" class="edit-combination icon-button btn-xs"\n                                            v-if="combination.id"\n                                            style="position: absolute; right: 5px; bottom: 5px"\n                                            data-toggle="tooltip"\n                                            title="Edit Key Combination"\n                                            v-on:click="editCombination(combination)"><i\n                                            class="mdi mdi-square-edit-outline"\n                                            aria-hidden="true"></i></button>\n\n                                    <p v-if="combination.id" class="card-text"><a\n                                            :href="\'/collecting/combination-statistics/\' + combination.id + \'/\'">[[combination.description]]</a>\n                                    </p>\n                                    <p v-else>[[combination.description]]</p>\n                                    <p class="card-text" v-html=prettifyKeys(combination.keys)></p>\n                                    <p class="card-text">Change: [[combination.old_confidence]] to\n                                        [[combination.new_confidence]] <i class="mdi mdi-party-popper"\n                                                                          v-show="combination.old_confidence <= 2 && combination.new_confidence > 2"\n                                                                          title="Congratulations, you have mastered this combination!"\n                                                                          aria-hidden="true"></i></p>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n\n\n                <div v-show="finished" id="chart-container">\n                    <canvas height="100" id="learningResultsChart"></canvas>\n                </div>\n\n                <div class="row mt-3" v-if="keyMap" style="min-width: 1020px">\n                    <div class="col-lg-auto col-md-12 order-lg-2 m-lg-auto">\n                        <div id="keyboard" class="trainer" style="min-width: 708px">\n                            <div class="kbdrow">\n                                <button id="esc">Esc</button>\n                                <div class="spacer-key"></div>\n                                <button id="F1">F1</button>\n                                <button id="F2">F2</button>\n                                <button id="F3">F3</button>\n                                <button id="F4">F4</button>\n                                <div class="spacer-small"></div>\n                                <button id="F5">F5</button>\n                                <button id="F6">F6</button>\n                                <button id="F7">F7</button>\n                                <button id="F8">F8</button>\n                                <div class="spacer-small"></div>\n                                <button id="F9">F9</button>\n                                <button id="F10">F10</button>\n                                <button id="F11">F11</button>\n                                <button id="F12">F12</button>\n                            </div>\n                            <div class="kbdrow">\n                                <div class="spacer-small"></div>\n                            </div>\n                            <div class="kbdrow">\n                                <trainingKbdBtn itemKey="Backquote">`</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit1">1</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit2">2</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit3">3</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit4">4</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit5">5</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit6">6</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit7">7</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit8">8</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit9">9</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Digit0">0</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Minus">-</trainingKbdBtn>\n                                <trainingKbdBtn itemKey="Equal">=</trainingKbdBtn>\n                                <button id="Backspace" style="width: 71.4px">&larr;</button>\n                                <div class="spacer-small"></div>\n                                <button id="Insert">Ins</button>\n                                <button style="font-size: 9px" id="Home">Home</button>\n                                <button style="font-size: 9px" id="PageUp">Pageup</button>\n                            </div>\n                            <div class="kbdrow">\n                                <div class="kbdcol">\n                                    <div class="kbdrow">\n                                        <button id="Tab" style="width: 50.4px">&#8677;</button>\n                                        <trainingKbdBtn itemKey="KeyQ">Q</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyW">W</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyE">E</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyR">R</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyT">T</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyY">Y</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyU">U</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyI">I</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyO">O</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyP"></trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="BracketLeft"></trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="BracketRight"></trainingKbdBtn>\n                                        <trainingKbdBtn style="width: 57.4px" itemKey="Backslash"></trainingKbdBtn>\n                                        <div class="spacer-small"></div>\n                                        <button id="Delete">Del</button>\n                                        <button id="End">End</button>\n                                        <button style="font-size: 9px" id="PageDown">Page down</button>\n                                    </div>\n                                    <div class="kbdrow">\n                                        <button id="CapsLock" style="width: 61.6px">&#8682;</button>\n                                        <trainingKbdBtn itemKey="KeyA">A</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyS">S</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyD">D</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyF">F</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyG">G</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyH">H</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyJ">J</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyK">K</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyL">L</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="Semicolon">;</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="Quote">\'</trainingKbdBtn>\n                                        <button id="Enter" style="width: 84.7px">&crarr;</button>\n                                        <div class="spacer-small"></div>\n                                        <div class="spacer-key"></div>\n                                        <div class="spacer-key"></div>\n                                        <div class="spacer-key"></div>\n                                    </div>\n                                </div>\n                            </div>\n                            <div class="kbdrow">\n                                <div class="kbdcol">\n                                    <div class="kbdrow">\n                                        <button id="ShiftLeft" style="width: 51.7px">&#8679;</button>\n                                        <trainingKbdBtn itemKey="IntlBackslash">|</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyZ">Z</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyX">X</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyC">C</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyV">V</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyB">B</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyN">N</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="KeyM">M</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="Comma">,</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="Period">.</trainingKbdBtn>\n                                        <trainingKbdBtn itemKey="Slash">/</trainingKbdBtn>\n                                        <button id="ShiftRight" style="width: 94.6px">&#8679;</button>\n                                        <div class="spacer-small"></div>\n                                        <div class="spacer-key"></div>\n                                        <button id="ArrowUp">&uarr;</button>\n                                        <div class="spacer-key"></div>\n                                    </div>\n                                    <div class="kbdrow">\n                                        <button id="ControlLeft" style="width: 57.4px">Ctrl</button>\n\n                                        <template v-if="isMac">\n                                            <button id="AltLeft" style="width: 47.6px">Alt</button>\n                                            <button v-once id="MetaLeft" style="width: 47.6px">Cmd\n                                        </template>\n                                        <template v-else>\n                                            <button v-once id="MetaLeft" style="width: 47.6px">Meta</button>\n                                            <button id="AltLeft" style="width: 47.6px">Alt</button>\n                                        </template>\n\n                                        <button id="Space" style="width: 214.2px">Space</button>\n\n                                        <template v-if="isMac">\n                                            <button v-once id="MetaRight" style="width: 47.6px">[[getSuperKeyLabel()]]\n                                            </button>\n                                            <button id="AltRight" style="width: 47.6px">Alt</button>\n                                        </template>\n                                        <template v-else>\n                                            <button id="AltRight" style="width: 47.6px">AltGr</button>\n                                            <button v-once id="MetaRight" style="width: 47.6px">[[getSuperKeyLabel()]]\n                                            </button>\n                                        </template>\n                                        <button id="ContextMenu"></button>\n                                        <button id="ControlRight" style="width: 58.8px">Ctrl</button>\n                                        <div class="spacer-small"></div>\n                                        <button id="ArrowLeft">&larr;</button>\n                                        <button id="ArrowDown">&darr;</button>\n                                        <button id="ArrowRight">&rarr;</button>\n                                    </div>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="col-2 order-lg-1 mt-lg-0 mt-3">\n                        <div class="card" v-if="!finished">\n                            <div class="card-header">\n                                Statistics\n                            </div>\n                            <div class="card-body py-0 px-0">\n                                <table class="table m-0">\n                                    <tbody>\n                                    <tr>\n                                        <td style="border-top: none" class="pr-0">Correct:</td>\n                                        <td class="text-center" style="border-top: none;"><span\n                                                class="rounded successbackground"\n                                                style="float: right; min-width: 40px;">[[total_score]]</span>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td style="border-top: none;" class="pr-0">With Hints:</td>\n                                        <td class="text-center" style="border-top: none"> <span\n                                                class="rounded withhintsbackground"\n                                                style="float: right; min-width: 40px;">[[total_with_hints]]</span>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td style="border-top: none;" class="pr-0">Errors:</td>\n                                        <td class="text-center" style="border-top: none"><span\n                                                class="rounded errorbackground"\n                                                style="float: right; min-width: 40px;">[[total_error]]</span>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td style="border-top: none;" class="pr-0">Skipped:</td>\n                                        <td class="text-center" style="border-top: none"><span\n                                                class="rounded skippedbackground"\n                                                style="float: right; min-width: 40px;">[[total_skipped]]</span>\n                                        </td>\n                                    </tr>\n                                    <tr>\n                                        <td style="border-top: none;" class="pr-0"> Time (s):</td>\n                                        <td class="text-center abcde3" style="border-top: none"><span\n                                                class="rounded timebackground"\n                                                style="float: right; min-width: 40px;">[[averageOfAverages]]</span>\n                                        </td>\n                                    </tr>\n                                    </tbody>\n                                </table>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="col-3 col-lg-2 order-lg-3 mt-lg-0 mt-3">\n                        <div class="card">\n                            <div class="card-header">\n                                Key Hints\n                            </div>\n                            <div class="card-body text-left">\n                                <b-form-group>\n                                    <b-form-radio v-model="config.keyDisplayMode" value="1">Show\n                                    </b-form-radio>\n                                    <b-form-radio v-model="config.keyDisplayMode" value="2">After\n                                        Delay\n                                    </b-form-radio>\n                                    <b-form-radio v-model="config.keyDisplayMode" value="4">Hide\n                                    </b-form-radio>\n                                </b-form-group>\n                                <label for="delay-range-input">Delay ([[config.keyDisplaydelay]] ms)</label>\n                                <b-form-input id="delay-range-input" v-model="config.keyDisplaydelay" type="range"\n                                              min="0" max="10000"\n                                              step="250"></b-form-input>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n    '});